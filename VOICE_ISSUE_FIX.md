# 语音选择常见问题解决方案

**Date: 2026-01-18**  
**Author: zhangxiaoxiao**

---

## 问题：显示"未找到推荐的女声"

### 问题描述

在 Grade2 Chinese（二年级语文）听写模式中，点击语音选择按钮后，提示："未找到推荐的女声，请检查系统语音设置"。

### 问题原因

代码设计得比较严格，只查找这4个特定的推荐中文女声：

1. **晓晓** (Xiaoxiao) - 标准女声，最自然
2. **晓伊** (Xiaoyi) - 儿童女声，活泼
3. **云希** (Yunxi) - 温柔女声
4. **晓墨** (Xiaomo) - 温暖女声

如果您的系统没有安装这些 Microsoft 中文语音，就会显示错误提示。

---

## ✅ 解决方案（已修复）

### 修复内容

现在代码会自动适配您的系统：

1. **优先显示推荐语音** - 如果系统有晓晓、晓伊、云希、晓墨，优先显示
2. **自动降级** - 如果没有推荐语音，会显示系统所有可用的中文语音
3. **友好提示** - 区分显示"⭐ 推荐语音"或"📢 可用语音"
4. **高清标记** - Natural/Online 版本会显示"高清"徽章

### 修复后的行为

```
情况1：有推荐语音
┌────────────────────────────┐
│ ⭐ 推荐语音                │
│ 👩 晓晓 [高清]            │
│ 👧 晓伊 [高清]            │
│ 👩‍🎤 云希 [高清]            │
└────────────────────────────┘

情况2：没有推荐语音，但有其他中文语音
┌────────────────────────────┐
│ 📢 可用语音                │
│ 🔊 Microsoft Huihui        │
│ 🔊 Google 中文（简体）     │
└────────────────────────────┘

情况3：完全没有中文语音
┌────────────────────────────┐
│ 未找到可用的中文语音        │
│ 请检查浏览器和系统语音设置  │
└────────────────────────────┘
```

---

## 🔍 如何检查您的系统有哪些语音

### 方法1：浏览器控制台

1. 打开听写页面
2. 按 `F12` 打开开发者工具
3. 在 Console 控制台输入：

```javascript
speechSynthesis.getVoices().forEach(v => {
    if (v.lang.startsWith('zh')) {
        console.log(v.name, '-', v.lang);
    }
});
```

4. 查看输出的中文语音列表

### 方法2：点击语音选择按钮

直接点击页面右上角的 🎙️ 按钮，查看面板中显示的语音列表。

---

## 💡 如何安装推荐的中文语音

### Windows 10/11 系统

#### 安装 Microsoft 中文语音

1. **打开设置**
   - 按 `Win + I` 打开设置
   - 或点击开始菜单 → 设置

2. **进入语音设置**
   - 点击"时间和语言"
   - 点击"语音"
   - 点击"管理语音"或"添加语音"

3. **安装中文语音包**
   - 找到"中文（简体，中国）"
   - 点击展开
   - 下载并安装语音包

4. **可用的高质量语音**
   - Microsoft Xiaoxiao Online (Natural) - 需要网络
   - Microsoft Xiaoyi Online (Natural) - 需要网络
   - Microsoft Yunxi Online (Natural) - 需要网络

### macOS 系统

1. **打开系统偏好设置**
   - 点击"辅助功能"
   - 点击"朗读内容"

2. **下载中文语音**
   - 点击"系统语音"
   - 在列表中找到中文语音
   - 点击下载

### Chrome 浏览器

Chrome 自带 Google 中文语音，无需额外安装。确保：
- 浏览器已更新到最新版本
- 网络连接正常（Google 语音需要联网）

---

## 🔧 技术细节

### 修改的代码逻辑

#### 之前的代码

```javascript
// 只显示4个推荐语音，如果找不到就报错
if (filteredVoices.length === 0) {
    voiceList.innerHTML = '未找到推荐的女声，请检查系统语音设置';
    return;
}
```

#### 修改后的代码

```javascript
// 如果没有找到推荐的女声，显示所有中文语音
if (filteredVoices.length === 0) {
    console.log('未找到推荐的女声，显示所有可用中文语音');
    chineseVoices.forEach(voice => {
        filteredVoices.push({
            voice: voice,
            icon: '🔊',
            desc: voice.name.includes('Female') || voice.name.includes('女') ? '女声' : '中文语音',
            isRecommended: false
        });
    });
}
```

### 语音识别规则

1. **推荐语音识别**
   - 优先查找包含关键字（Xiaoxiao、Xiaoyi、Yunxi、Xiaomo）且包含 "Natural" 的语音
   - 如果没有 Natural 版本，查找标准版

2. **降级方案**
   - 显示所有 `lang.startsWith('zh')` 的语音
   - 根据名称判断是否为女声

3. **名称简化**
   - Microsoft 语音去掉 "Microsoft" 前缀
   - Google 语音去掉 "Google" 前缀
   - 保留关键信息便于识别

---

## 🎯 使用建议

### 推荐配置（最佳体验）

- **操作系统**：Windows 10/11
- **浏览器**：Chrome 或 Edge（最新版本）
- **网络**：保持连接（Natural 语音需要联网）
- **语音**：安装 Microsoft Natural 中文语音包

### 最低配置（基本可用）

- **操作系统**：任何支持 Web Speech API 的系统
- **浏览器**：Chrome、Edge、Firefox、Safari
- **语音**：系统自带的任何中文语音即可

### 推荐语音质量对比

| 语音类型 | 音质 | 是否需要网络 | 推荐度 |
|---------|------|-------------|--------|
| Microsoft Natural | ⭐⭐⭐⭐⭐ 最接近真人 | 需要 | ⭐⭐⭐⭐⭐ |
| Google 中文 | ⭐⭐⭐⭐ 自然流畅 | 需要 | ⭐⭐⭐⭐ |
| Microsoft 标准版 | ⭐⭐⭐ 清晰可用 | 不需要 | ⭐⭐⭐ |
| 系统自带 | ⭐⭐ 基本可用 | 不需要 | ⭐⭐ |

---

## 📱 不同设备的语音支持

### Windows 10/11
- ✅ Microsoft Natural 语音（需要联网）
- ✅ Microsoft 标准语音
- ✅ Google 语音（Chrome浏览器）

### macOS
- ✅ Apple 中文语音（Ting-Ting 等）
- ✅ Google 语音（Chrome浏览器）

### iOS/iPadOS
- ✅ Apple 中文语音
- ⚠️ Safari 对 Web Speech API 支持有限

### Android
- ✅ Google 中文语音
- ✅ 系统自带中文语音

### Linux
- ⚠️ 取决于安装的 TTS 引擎
- ✅ Google 语音（Chrome浏览器）

---

## 🐛 常见问题

### Q1: 为什么我看到的语音很少？

**A**: 可能原因：
1. 系统未安装中文语音包
2. 浏览器版本过旧
3. 语音服务未启动

**解决方案**：
- 安装中文语音包（参考上文）
- 更新浏览器到最新版本
- 重启浏览器或系统

### Q2: 为什么有些语音听起来很机械？

**A**: 
- **Natural 语音**：采用神经网络，音质接近真人
- **标准语音**：采用拼接技术，可能较机械

**建议**：优先选择名称中带 "Natural" 或 "Online" 的语音

### Q3: 为什么语音选择后没反应？

**A**: 
1. 检查浏览器是否允许自动播放音频
2. 检查系统音量设置
3. 尝试刷新页面（Ctrl+F5）

### Q4: 可以离线使用吗？

**A**: 
- **可以**：系统自带的标准语音
- **不可以**：Microsoft Natural 和 Google 语音需要联网

---

## 📝 更新日志

### v2.2.1 - 2026-01-18 15:45

**修复内容**：
- ✅ 修复"未找到推荐的女声"问题
- ✅ 添加自动降级逻辑，显示所有可用中文语音
- ✅ 添加"推荐语音"和"可用语音"标题区分
- ✅ 为 Natural/Online 语音添加"高清"徽章
- ✅ 统一 active 和 selected 类名，修复选中状态显示

---

## 📞 技术支持

如有其他问题，请：
- 查看 [VOICE_SELECTION_GUIDE.md](VOICE_SELECTION_GUIDE.md)
- 提交 GitHub Issue
- 查看浏览器控制台的错误信息

---

**祝您学习愉快！** 📚

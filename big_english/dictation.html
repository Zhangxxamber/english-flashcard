<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Big English 1 å•è¯é»˜å†™ç»ƒä¹ å·¥å…·">
    <meta name="keywords" content="Big English,è‹±è¯­å•è¯,é»˜å†™,å­¦ä¹ å·¥å…·">
    <meta name="author" content="Zhangxxamber">
    <title>Big English 1 å•è¯é»˜å†™</title>
    
    <!-- å¼•å…¥ Book 2-6 æ•°æ® -->
    <script src="data/vocabulary_book2.js"></script>
    <script src="data/vocabulary_book3.js"></script>
    <script src="data/vocabulary_book4.js"></script>
    <script src="data/vocabulary_book5.js"></script>
    <script src="data/vocabulary_book6.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-attachment: fixed; /* é˜²æ­¢Edgeæµè§ˆå™¨èƒŒæ™¯é—ªçƒ */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            -webkit-font-smoothing: antialiased; /* æ”¹å–„å­—ä½“æ¸²æŸ“ */
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            max-width: 900px;
            width: 100%;
        }

        /* æ ‡é¢˜åŒºåŸŸ */
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        /* è¿”å›æŒ‰é’® */
        .btn-home {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 12px 24px;
            background: rgba(255,255,255,0.25);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.4);
            z-index: 1000;
            cursor: pointer;
            animation: fadeIn 0.5s ease-in;
        }

        .btn-home:hover {
            background: rgba(255,255,255,0.4);
            transform: translateX(-5px);
            border-color: rgba(255,255,255,0.6);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* éŸ³æ•ˆå¼€å…³æŒ‰é’® */
        .btn-sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.25);
            border: 2px solid rgba(255,255,255,0.4);
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease-in;
        }

        .btn-sound-toggle:hover {
            background: rgba(255,255,255,0.4);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-sound-toggle.muted {
            background: rgba(255,100,100,0.3);
            border-color: rgba(255,100,100,0.5);
        }

        /* è¯­éŸ³é€‰æ‹©æŒ‰é’® - è°ƒè¯•ç‰ˆæœ¬ */
        .btn-voice-select {
            position: fixed;
            top: 20px;
            right: 85px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,0,0,0.8) !important; /* çº¢è‰²èƒŒæ™¯ä¾¿äºè°ƒè¯• */
            border: 3px solid yellow !important; /* é»„è‰²è¾¹æ¡†ä¾¿äºè°ƒè¯• */
            color: white;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            z-index: 9999 !important; /* æé«˜å±‚çº§ */
            display: flex !important;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease-in;
            box-shadow: 0 0 20px red !important; /* çº¢è‰²å‘å…‰æ•ˆæœ */
        }

        .btn-voice-select:hover {
            background: rgba(255,255,255,0.4);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* è¯­éŸ³é€‰æ‹©é¢æ¿ */
        .voice-panel {
            position: fixed;
            top: 75px;
            right: 20px;
            width: 320px;
            max-height: 500px;
            background: rgba(30, 30, 40, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            z-index: 999;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .voice-panel.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .voice-panel-title {
            color: white;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .voice-current {
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.5);
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 15px;
            color: white;
            font-size: 0.9em;
        }

        .voice-current-label {
            color: rgba(255,255,255,0.6);
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .voice-current-name {
            font-weight: bold;
            color: #8b9cfc;
            font-size: 1.1em;
        }

        .voice-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .voice-list::-webkit-scrollbar {
            width: 8px;
        }

        .voice-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .voice-list::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        .voice-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        .voice-item {
            background: rgba(255,255,255,0.1);
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .voice-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }

        .voice-item.active {
            background: rgba(102, 126, 234, 0.4);
            border-color: rgba(102, 126, 234, 0.8);
        }

        .voice-name {
            color: white;
            font-size: 1em;
            font-weight: bold;
        }

        .voice-label {
            color: rgba(255,255,255,0.7);
            font-size: 0.85em;
            margin-top: 3px;
        }

        .voice-try {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }

        .voice-try:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .voice-loading {
            color: rgba(255,255,255,0.6);
            text-align: center;
            padding: 20px;
        }

        /* è¿å‡»å¾½ç«  */
        .combo-badge {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 3px 3px 10px rgba(0,0,0,0.5);
            animation: comboAppear 0.5s ease-out;
            z-index: 1000;
            pointer-events: none;
        }

        @keyframes comboAppear {
            0% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* ç»Ÿè®¡é¢æ¿ */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-value.correct {
            color: #4ecdc4;
        }

        .stat-value.wrong {
            color: #ff6b6b;
        }

        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .control-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-label {
            font-weight: bold;
            color: #333;
            min-width: 80px;
        }

        /* å•å…ƒé€‰æ‹©å™¨æŒ‰é’®æ ·å¼ */
        .unit-selector-label {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .unit-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .unit-btn {
            padding: 12px 10px;
            font-size: 0.95em;
            font-weight: bold;
            border: 2px solid rgba(102, 126, 234, 0.3);
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .unit-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .unit-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }

        .unit-btn.all-units {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            border-color: #44a08d;
        }

        .unit-btn.all-units.active {
            background: linear-gradient(135deg, #45b7d1 0%, #3a9d8f 100%);
        }

        select, .btn {
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        select {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        /* é»˜å†™å¡ç‰‡ */
        .dictation-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            margin-bottom: 25px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .word-number {
            font-size: 1.5em;
            color: #999;
            margin-bottom: 30px;
            font-weight: bold;
        }

        /* å¤§å·å‘éŸ³æŒ‰é’® */
        .speaker-btn-large {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(102,126,234,0.4);
            margin-bottom: 40px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .speaker-btn-large:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(102,126,234,0.6);
        }

        .speaker-btn-large:active {
            transform: scale(0.95);
        }

        /* ä¸­æ–‡æ„æ€ï¼ˆå¤§å­—å·ï¼‰ */
        .word-meaning-large {
            font-size: 4.5em;
            color: #333;
            font-weight: bold;
            margin-bottom: 40px;
            text-align: center;
        }

        /* ç®€åŒ–çš„æç¤ºåŒºåŸŸ */
        .hint-area-simple {
            display: flex;
            gap: 40px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .hint-item-large {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px 35px;
            border-radius: 15px;
            font-size: 1.8em;
            border: 2px solid #dee2e6;
        }

        .hint-label {
            color: #667eea;
            font-weight: bold;
            margin-right: 10px;
        }

        .hint-value {
            color: #333;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* ç­”æ¡ˆåŒºåŸŸ */
        .answer-area {
            display: none;
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-radius: 15px;
            border: 3px solid #28a745;
            animation: fadeIn 0.3s ease-in;
        }

        .answer-area.show {
            display: block;
        }

        .answer-label {
            font-size: 1.8em;
            color: #155724;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .answer-text {
            font-size: 5em;
            font-weight: bold;
            color: #28a745;
            letter-spacing: 3px;
        }

        /* æŒ‰é’®åŒºåŸŸ */
        .button-area {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
            padding: 20px 0;
        }

        .button-area .btn {
            padding: 18px 40px;
            font-size: 1.3em;
            font-weight: bold;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.25);
        }

        .btn-show-answer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-show-answer:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .btn-wrong {
            background: #ff6b6b;
        }

        .btn-wrong:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .btn-correct {
            background: #4ecdc4;
        }

        .btn-correct:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* æ—§æ ·å¼ä¿ç•™ */
        .word-meaning {
            font-size: 2.5em;
            color: #333;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .word-example {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 30px;
            text-align: center;
            font-style: normal;
        }

        .hint-area {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .hint-item {
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.1em;
        }

        .hint-item strong {
            color: #667eea;
        }

        .phonetic-hint {
            color: #666;
            font-size: 1em;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-area {
            width: 100%;
            max-width: 500px;
            margin-bottom: 25px;
        }

        .letter-blanks {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .letter-blank {
            width: 40px;
            height: 50px;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            font-weight: bold;
            background: white;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

        .letter-blank.space {
            border: none;
            width: 15px;
        }

        .letter-blank.word-space {
            width: 40px;
            height: 50px;
            border: 2px solid #ccc;
            border-radius: 8px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #999;
            position: relative;
        }

        /* åœ¨ç©ºæ ¼æ–¹æ¡†ä¸­æ˜¾ç¤ºç©ºæ ¼ç¬¦å· */
        .letter-blank.word-space::after {
            content: 'â£';
            font-size: 1.8em;
            color: #aaa;
        }

        .letter-blank.filled {
            border-color: #667eea;
            color: #667eea;
        }

        .letter-blank.correct {
            border-color: #4ecdc4;
            background: #e8f8f5;
            color: #4ecdc4;
        }

        .letter-blank.wrong {
            border-color: #ff6b6b;
            background: #ffe8e8;
            color: #ff6b6b;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        #wordInput {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.5em;
            border: 3px solid #ddd;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            letter-spacing: 3px;
            transition: all 0.3s;
        }

        #wordInput:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
        }

        #wordInput.correct {
            border-color: #4ecdc4;
            background: #e8f8f5;
        }

        #wordInput.wrong {
            border-color: #ff6b6b;
            background: #ffe8e8;
        }

        /* åé¦ˆæ¶ˆæ¯ */
        .feedback {
            font-size: 1.3em;
            font-weight: bold;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.wrong {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æŒ‰é’®ç»„ */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* é”™é¢˜æœ¬ */
        .mistake-list {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            margin-top: 25px;
        }

        .mistake-list h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-align: center;
        }

        .mistake-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .mistake-item {
            background: #fff5f5;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
        }

        .mistake-item .word {
            font-weight: bold;
            color: #ff6b6b;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .mistake-item .meaning {
            color: #666;
            font-size: 0.9em;
        }

        .mistake-item .wrong-answer {
            color: #999;
            font-size: 0.85em;
            margin-top: 5px;
            font-style: italic;
        }

        /* å®Œæˆç•Œé¢ */
        .completion-screen {
            display: none;
            text-align: center;
        }

        .completion-screen.show {
            display: block;
            animation: fadeIn 0.5s;
        }

        .completion-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .completion-title {
            font-size: 2.5em;
            color: #333;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .completion-stats {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
        }

        .completion-stat {
            font-size: 1.3em;
            margin: 10px 0;
            color: #555;
        }

        .accuracy {
            font-size: 3em;
            font-weight: bold;
            color: #4ecdc4;
            margin: 20px 0;
        }

        .accuracy.low {
            color: #ff6b6b;
        }

        .accuracy.medium {
            color: #ffa500;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .dictation-card {
                padding: 25px;
                min-height: 350px;
            }

            .word-meaning {
                font-size: 2em;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 1.5em;
            }

            .letter-blank {
                width: 35px;
                height: 45px;
                font-size: 1.5em;
            }

            .control-panel {
                padding: 20px;
            }

            .control-row {
                flex-direction: column;
                align-items: stretch;
            }

            .control-label {
                margin-bottom: 8px;
            }
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            transition: width 0.3s;
            border-radius: 4px;
        }

        /* è¿”å›æŒ‰é’® */
        /* å·²åœ¨ä¸Šæ–¹å®šä¹‰ä¸º .btn-home */

        /* å‘éŸ³æŒ‰é’® */
        .speaker-btn {
            background: none;
            border: none;
            font-size: 1.3em;
            cursor: pointer;
            padding: 0 5px;
            transition: transform 0.2s;
            vertical-align: middle;
            margin-left: 10px;
        }

        .speaker-btn:hover {
            transform: scale(1.2);
        }

        .speaker-btn:active {
            transform: scale(0.9);
        }
    </style>
</head>
<body>
    <!-- éŸ³æ•ˆå¼€å…³æŒ‰é’® -->
    <button class="btn-sound-toggle" id="soundToggle" onclick="toggleSound()">
        <span id="soundIcon">ğŸ”Š</span>
    </button>
    <!-- è¯­éŸ³é€‰æ‹©æŒ‰é’® - è°ƒè¯•ç‰ˆæœ¬ -->
    <button class="btn-voice-select" id="voiceToggle" onclick="toggleVoicePanel()" 
            style="background: red !important; border: 3px solid yellow !important; box-shadow: 0 0 20px red !important;">
        ğŸ™ï¸ è¯­éŸ³
    </button>
    <script>
        console.log('=== Big English è¯­éŸ³é€‰æ‹©æŒ‰é’®è°ƒè¯•ä¿¡æ¯ ===');
        console.log('æŒ‰é’®HTMLå·²åŠ è½½');
        window.addEventListener('DOMContentLoaded', function() {
            const voiceBtn = document.getElementById('voiceToggle');
            if (voiceBtn) {
                console.log('âœ… æ‰¾åˆ°è¯­éŸ³é€‰æ‹©æŒ‰é’®å…ƒç´ :', voiceBtn);
                console.log('æŒ‰é’®ä½ç½®:', voiceBtn.getBoundingClientRect());
            } else {
                console.error('âŒ æ‰¾ä¸åˆ°è¯­éŸ³é€‰æ‹©æŒ‰é’®å…ƒç´ ï¼');
            }
        });
    </script>
    
    <!-- è¯­éŸ³é€‰æ‹©é¢æ¿ -->
    <div class="voice-panel" id="voicePanel">
        <div class="voice-panel-title">ğŸ™ï¸ é€‰æ‹©è‹±æ–‡å‘éŸ³äºº</div>
        <div class="voice-current" id="voiceCurrent">
            <div class="voice-current-label">Current Voice:</div>
            <div class="voice-current-name" id="voiceCurrentName">Loading...</div>
        </div>
        <div class="voice-list" id="voiceList">
            <div class="voice-loading">åŠ è½½ä¸­...</div>
        </div>
    </div>
    
    <!-- è¿”å›æŒ‰é’®ï¼ˆç‹¬ç«‹äºå®¹å™¨å¤–ï¼‰ -->
    <button class="btn-home" onclick="safeReturn()">â† è¿”å›</button>
    
    <div class="container">
        <!-- æ ‡é¢˜ -->
        <div class="header">
            <h1 id="pageTitle">âœï¸ Big English 1 å•è¯é»˜å†™</h1>
            <p>æ ¹æ®ä¸­æ–‡æ„æ€ï¼Œæ‹¼å†™å‡ºæ­£ç¡®çš„è‹±æ–‡å•è¯</p>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- ç»Ÿè®¡é¢æ¿ -->
        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-label">è¿›åº¦</div>
                <div class="stat-value" id="currentIndex">åŠ è½½ä¸­...</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æ­£ç¡®</div>
                <div class="stat-value correct" id="correctCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">é”™è¯¯</div>
                <div class="stat-value wrong" id="wrongCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æ­£ç¡®ç‡</div>
                <div class="stat-value" id="accuracy">100%</div>
            </div>
            <div class="stat-card" style="background: rgba(255,180,100,0.2); border: 2px solid rgba(255,180,100,0.5);">
                <div class="stat-label">ğŸ“– å†å²é”™é¢˜</div>
                <div class="stat-value" id="historyWrongCount" style="color: #ff9966; font-weight: bold;">0</div>
            </div>
            <div class="stat-card" id="currentWrongItem" style="background: rgba(255,100,100,0.2); border: 2px solid rgba(255,100,100,0.5);">
                <div class="stat-label">ğŸ“š æœ¬æ¬¡æ–°å¢</div>
                <div class="stat-value" id="currentWrongItemsCount" style="color: #ff6b6b; font-weight: bold;">0</div>
            </div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel" style="display: none;">
            <!-- éšè—é€‰æ‹©é¢æ¿ï¼Œåœ¨ index.html ä¸­é€‰æ‹© -->
            <div class="control-row">
                <div class="unit-selector-label">ğŸ“š é€‰æ‹©å•å…ƒ</div>
            </div>
            <div class="control-row">
                <div class="unit-buttons" id="unitButtons" style="width: 100%;">
                    <!-- å•å…ƒæŒ‰é’®å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            <div class="control-row">
                <span class="control-label">å­¦ä¹ æ¨¡å¼ï¼š</span>
                <button class="btn" onclick="startDictation('sequential')">ğŸ“ é¡ºåºé»˜å†™</button>
                <button class="btn" onclick="startDictation('random')">ğŸ² éšæœºé»˜å†™</button>
                <button class="btn btn-danger" onclick="startDictation('mistakes')" id="mistakeBtn" disabled>âŒ é”™é¢˜é‡ç»ƒ (0)</button>
            </div>
        </div>

        <!-- é»˜å†™å¡ç‰‡ -->
        <div class="dictation-card" id="dictationCard" style="display: block;">
            <!-- å‘éŸ³æŒ‰é’®ï¼ˆå¤§è€Œæ˜æ˜¾ï¼‰ -->
            <div style="cursor: pointer; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 20px; margin-bottom: 30px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); transition: all 0.3s;" onclick="speakWord()">
                <div id="phoneticDisplay" style="font-size: 2.5em; font-weight: bold; margin-bottom: 15px;">/ËˆstuËdnt/</div>
                <div style="font-size: 1.2em; opacity: 0.9;">ğŸ”Š ç‚¹å‡»æ’­æ”¾å‘éŸ³</div>
            </div>

            <!-- é¢˜ç›®ä¿¡æ¯ -->
            <div style="background: rgba(255,255,255,0.95); padding: 30px; border-radius: 15px; margin-bottom: 30px; text-align: center;">
                <div class="question-number" id="questionNumber" style="font-size: 1.1em; color: #666; margin-bottom: 20px;">ç¬¬ 1 é¢˜ / å…± 10 é¢˜</div>
                <div style="margin-bottom: 15px;">
                    <div style="font-size: 1.1em; color: #999; margin-bottom: 8px;">ä¸­æ–‡æ„æ€</div>
                    <div class="chinese-text" id="wordMeaning" style="font-size: 2.2em; font-weight: bold; color: #333;">å­¦ç”Ÿ</div>
                </div>
                <div style="font-size: 0.95em; color: #999; margin-top: 15px;">
                    <span style="margin-right: 15px;">é¦–å­—æ¯: <strong id="firstLetter">s</strong></span>
                    <span>å­—æ¯æ•°: <strong id="wordLength">7</strong></span>
                </div>
            </div>

            <!-- ç­”æ¡ˆæ˜¾ç¤ºåŒºï¼ˆåˆå§‹éšè—ï¼‰-->
            <div id="answerArea" style="display: none; background: rgba(78, 205, 196, 0.1); padding: 25px; border-radius: 15px; margin-bottom: 30px; border: 3px solid #4ecdc4;">
                <div style="font-size: 1.2em; color: #4ecdc4; margin-bottom: 10px;">âœ¨ ç­”æ¡ˆï¼š</div>
                <div id="answerText" style="font-size: 2.2em; font-weight: bold; color: #4ecdc4;">student</div>
            </div>

            <!-- æŒ‰é’®åŒºåŸŸ -->
            <div class="button-area">
                <button class="btn btn-show-answer" onclick="showAnswer()" id="showAnswerBtn">ğŸ’¡ æ˜¾ç¤ºç­”æ¡ˆ</button>
                <button class="btn btn-wrong" onclick="markWrong()">âŒ è¿˜ä¸ä¼š</button>
                <button class="btn btn-correct" onclick="markCorrect()">âœ… ä¼šäº†</button>
            </div>
        </div>

        <!-- å®Œæˆç•Œé¢ -->
        <div class="completion-screen" id="completionScreen">
            <div class="completion-icon">ğŸ‰</div>
            <div class="completion-title">æ­å–œå®Œæˆï¼</div>
            <div class="completion-stats">
                <div class="completion-stat">æ€»å…±ç»ƒä¹ ï¼š<strong id="totalWords">0</strong> ä¸ªå•è¯</div>
                <div class="completion-stat">æ­£ç¡®ï¼š<strong id="finalCorrect" style="color: #4ecdc4;">0</strong> ä¸ª</div>
                <div class="completion-stat">é”™è¯¯ï¼š<strong id="finalWrong" style="color: #ff6b6b;">0</strong> ä¸ª</div>
                <div class="accuracy" id="finalAccuracy">100%</div>
                <div id="encouragement" style="font-size: 1.2em; color: #666; margin-top: 10px;"></div>
            </div>
            <div class="button-group">
                <button class="btn" onclick="resetDictation()">ğŸ”„ é‡æ–°å¼€å§‹</button>
                <button class="btn btn-danger" onclick="startDictation('mistakes')" id="reviewMistakesBtn" style="display: none;">âŒ å¤ä¹ é”™é¢˜</button>
                <a href="index.html" class="btn btn-secondary">ğŸ  è¿”å›ä¸»é¡µ</a>
            </div>
        </div>

        <!-- é”™é¢˜æœ¬ -->
        <div class="mistake-list" id="mistakeList" style="display: none;">
            <h3>âŒ é”™é¢˜è®°å½•</h3>
            <div class="mistake-items" id="mistakeItems"></div>
        </div>
    </div>

    <script>
        // ==================== è¯­éŸ³é€‰æ‹©ç³»ç»Ÿ ====================
        // Date: 2026-01-18
        // Author: zhangxiaoxiao
        
        let availableVoices = [];
        let selectedVoice = null;
        
        // åŠ è½½å¯ç”¨è¯­éŸ³åˆ—è¡¨
        // Date: 2026-01-18
        // Author: zhangxiaoxiao
        function loadVoices() {
            console.log('=== loadVoices è¢«è°ƒç”¨ ===');
            availableVoices = speechSynthesis.getVoices();
            console.log('è·å–åˆ°çš„è¯­éŸ³æ•°é‡:', availableVoices.length);
            
            if (availableVoices.length > 0) {
                console.log('å¼€å§‹å¡«å……è¯­éŸ³åˆ—è¡¨å’ŒåŠ è½½åå¥½');
                populateVoiceList();
                loadVoicePreference();
            } else {
                console.warn('è¯­éŸ³åˆ—è¡¨ä¸ºç©ºï¼Œå¯èƒ½è¿˜åœ¨åŠ è½½ä¸­');
            }
        }
        
        // å¡«å……è¯­éŸ³é€‰æ‹©åˆ—è¡¨ - ä¼˜å…ˆæ˜¾ç¤ºè‹±æ–‡å‘éŸ³äºº
        // Date: 2026-01-18
        // Author: zhangxiaoxiao
        function populateVoiceList() {
            console.log('=== populateVoiceList è¢«è°ƒç”¨ ===');
            const voiceList = document.getElementById('voiceList');
            console.log('voiceList å…ƒç´ :', voiceList);
            const englishVoices = availableVoices.filter(v => v.lang.startsWith('en'));
            console.log('å¯ç”¨è‹±æ–‡è¯­éŸ³æ•°é‡:', englishVoices.length);
            console.log('æ‰€æœ‰å¯ç”¨è¯­éŸ³:', availableVoices.map(v => v.name));
            
            if (englishVoices.length === 0) {
                console.warn('æœªæ‰¾åˆ°è‹±æ–‡è¯­éŸ³');
                voiceList.innerHTML = '<div class="voice-loading">æœªæ‰¾åˆ°è‹±æ–‡å‘éŸ³äººï¼Œå°†ä½¿ç”¨ç³»ç»Ÿé»˜è®¤</div>';
                return;
            }
            
            // æ¨èçš„è‹±æ–‡å‘éŸ³äººï¼ˆä¼˜å…ˆæ˜¾ç¤ºï¼‰
            const recommendedVoices = [
                'Microsoft Aria Online (Natural) - English (United States)',
                'Microsoft Jenny Online (Natural) - English (United States)',
                'Microsoft Guy Online (Natural) - English (United States)',
                'Google US English',
                'Google UK English Female',
                'Google UK English Male'
            ];
            
            voiceList.innerHTML = '';
            console.log('å·²æ¸…ç©º voiceList');
            
            let addedCount = 0;
            
            // å…ˆæ˜¾ç¤ºæ¨èçš„å‘éŸ³äºº
            recommendedVoices.forEach(name => {
                const voice = englishVoices.find(v => v.name === name || v.name.includes(name));
                if (voice) {
                    console.log('æ·»åŠ æ¨èè¯­éŸ³:', voice.name);
                    createVoiceItem(voice, voiceList);
                    addedCount++;
                }
            });
            
            // å†æ˜¾ç¤ºå…¶ä»–è‹±æ–‡å‘éŸ³äºº
            englishVoices.forEach(voice => {
                if (!recommendedVoices.some(name => voice.name === name || voice.name.includes(name))) {
                    console.log('æ·»åŠ å…¶ä»–è¯­éŸ³:', voice.name);
                    createVoiceItem(voice, voiceList);
                    addedCount++;
                }
            });
            
            console.log('å…±æ·»åŠ äº†', addedCount, 'ä¸ªè¯­éŸ³é€‰é¡¹');
            console.log('=== populateVoiceList å®Œæˆ ===');
        }
        
        // åˆ›å»ºè¯­éŸ³é€‰é¡¹å…ƒç´ 
        function createVoiceItem(voice, container) {
            const item = document.createElement('div');
            item.className = 'voice-item';
            if (selectedVoice && selectedVoice.name === voice.name) {
                item.classList.add('active');
            }
            
            const info = document.createElement('div');
            const nameDiv = document.createElement('div');
            nameDiv.className = 'voice-name';
            nameDiv.textContent = voice.name.split(' - ')[0];
            
            const labelDiv = document.createElement('div');
            labelDiv.className = 'voice-label';
            labelDiv.textContent = voice.lang;
            
            info.appendChild(nameDiv);
            info.appendChild(labelDiv);
            
            const tryBtn = document.createElement('button');
            tryBtn.className = 'voice-try';
            tryBtn.textContent = 'è¯•å¬';
            tryBtn.onclick = (e) => {
                e.stopPropagation();
                testVoice(voice);
            };
            
            item.appendChild(info);
            item.appendChild(tryBtn);
            
            item.onclick = () => selectVoice(voice);
            
            container.appendChild(item);
        }
        
        // é€‰æ‹©è¯­éŸ³
        // é€‰æ‹©è¯­éŸ³
        // Date: 2026-01-18
        // Author: zhangxiaoxiao
        function selectVoice(voice) {
            selectedVoice = voice;
            localStorage.setItem('bigEnglish_selectedVoice', voice.name);
            
            // æ›´æ–°UI
            document.querySelectorAll('.voice-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // æ›´æ–°å½“å‰ä½¿ç”¨æ˜¾ç¤º
            updateCurrentVoiceDisplay(voice);
            
            console.log('å·²é€‰æ‹©å‘éŸ³äºº:', voice.name);
        }
        
        // æ›´æ–°å½“å‰ä½¿ç”¨çš„è¯­éŸ³æ˜¾ç¤º
        // Date: 2026-01-18
        // Author: zhangxiaoxiao
        function updateCurrentVoiceDisplay(voice) {
            const currentNameEl = document.getElementById('voiceCurrentName');
            if (currentNameEl && voice) {
                // ç®€åŒ–æ˜¾ç¤ºåç§°
                let displayName = voice.name;
                if (voice.name.includes('Microsoft')) {
                    displayName = voice.name.split('-')[0].replace('Microsoft', '').trim();
                } else if (voice.name.includes('Google')) {
                    displayName = voice.name.replace('Google', '').trim();
                }
                
                // æ·»åŠ é«˜æ¸…æ ‡è®°
                const isNatural = voice.name.includes('Natural') || voice.name.includes('Online');
                const badge = isNatural ? ' â­' : '';
                
                currentNameEl.textContent = displayName + badge;
            }
        }
        
        // è¯•å¬è¯­éŸ³
        function testVoice(voice) {
            const utterance = new SpeechSynthesisUtterance('Hello! This is a test.');
            utterance.voice = voice;
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            speechSynthesis.cancel();
            speechSynthesis.speak(utterance);
        }
        
        // åŠ è½½è¯­éŸ³åå¥½
        // åŠ è½½è¯­éŸ³åå¥½
        // Date: 2026-01-18
        // Author: zhangxiaoxiao
        function loadVoicePreference() {
            const savedVoiceName = localStorage.getItem('bigEnglish_selectedVoice');
            if (savedVoiceName) {
                const voice = availableVoices.find(v => v.name === savedVoiceName);
                if (voice) {
                    selectedVoice = voice;
                    updateVoiceUI();
                    updateCurrentVoiceDisplay(voice);
                }
            } else {
                // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ªæ¨èçš„è‹±æ–‡å‘éŸ³äºº
                const defaultVoices = [
                    'Microsoft Aria Online (Natural) - English (United States)',
                    'Google US English',
                    'Google UK English Female'
                ];
                
                for (const name of defaultVoices) {
                    const voice = availableVoices.find(v => v.name === name || v.name.includes(name));
                    if (voice) {
                        selectedVoice = voice;
                        updateCurrentVoiceDisplay(voice);
                        break;
                    }
                }
                
                if (!selectedVoice && availableVoices.length > 0) {
                    const englishVoice = availableVoices.find(v => v.lang.startsWith('en'));
                    if (englishVoice) {
                        selectedVoice = englishVoice;
                        updateCurrentVoiceDisplay(englishVoice);
                    }
                }
                
                // å¦‚æœè¿˜æ˜¯æ²¡æœ‰é€‰æ‹©ï¼Œæ˜¾ç¤º"ç³»ç»Ÿé»˜è®¤"
                if (!selectedVoice) {
                    const currentNameEl = document.getElementById('voiceCurrentName');
                    if (currentNameEl) {
                        currentNameEl.textContent = 'System Default';
                    }
                }
            }
        }
        
        // æ›´æ–°è¯­éŸ³UI
        function updateVoiceUI() {
            document.querySelectorAll('.voice-item').forEach(item => {
                item.classList.remove('active');
                const voiceName = item.querySelector('.voice-name').textContent;
                if (selectedVoice && selectedVoice.name.includes(voiceName)) {
                    item.classList.add('active');
                }
            });
        }
        
        // åˆ‡æ¢è¯­éŸ³é€‰æ‹©é¢æ¿
        function toggleVoicePanel() {
            const panel = document.getElementById('voicePanel');
            panel.classList.toggle('show');
        }
        
        // ç‚¹å‡»å¤–éƒ¨å…³é—­é¢æ¿
        document.addEventListener('click', (e) => {
            const panel = document.getElementById('voicePanel');
            const toggleBtn = document.getElementById('voiceToggle');
            
            if (panel.classList.contains('show') && 
                !panel.contains(e.target) && 
                !toggleBtn.contains(e.target)) {
                panel.classList.remove('show');
            }
        });
        
        // åˆå§‹åŒ–è¯­éŸ³ç³»ç»Ÿ
        // Date: 2026-01-18
        // Author: zhangxiaoxiao
        console.log('=== å¼€å§‹åˆå§‹åŒ–è¯­éŸ³ç³»ç»Ÿ ===');
        if (speechSynthesis.onvoiceschanged !== undefined) {
            console.log('è®¾ç½® onvoiceschanged ç›‘å¬å™¨');
            speechSynthesis.onvoiceschanged = loadVoices;
        }
        console.log('é¦–æ¬¡è°ƒç”¨ loadVoices()');
        loadVoices();
        
        // 3ç§’åå†æ£€æŸ¥ä¸€æ¬¡ï¼Œç¡®ä¿è¯­éŸ³åŠ è½½å®Œæˆ
        setTimeout(() => {
            console.log('=== 3ç§’åå†æ¬¡æ£€æŸ¥è¯­éŸ³ ===');
            if (availableVoices.length === 0) {
                console.log('é‡æ–°åŠ è½½è¯­éŸ³');
                loadVoices();
            } else {
                console.log('è¯­éŸ³å·²åŠ è½½å®Œæˆï¼Œæ— éœ€é‡æ–°åŠ è½½');
            }
        }, 3000);
        
        // ==================== éŸ³æ•ˆç³»ç»Ÿ ====================
        
        // éŸ³æ•ˆçŠ¶æ€æ§åˆ¶
        let soundEnabled = true;
        let comboCount = 0; // è¿å¯¹æ¬¡æ•°
        
        // é¼“åŠ±è¯­éŸ³åº“ï¼ˆè‹±æ–‡ï¼‰
        const encouragementPhrases = [
            "Excellent!",
            "Great job!",
            "Well done!",
            "Fantastic!",
            "Perfect!",
            "Amazing!",
            "Wonderful!",
            "Outstanding!",
            "Brilliant!",
            "Superb!",
            "You're doing great!",
            "Keep it up!",
            "That's correct!",
            "Nice work!",
            "You got it!"
        ];
        
        // ä½¿ç”¨ Web Audio API ç”Ÿæˆå¡é€šéŸ³æ•ˆ
        function playSound(type) {
            if (!soundEnabled) return;
            
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'correct1':
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.1);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.15);
                    break;
                    
                case 'correct2':
                    [523, 659, 784].forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.15, audioContext.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                        osc.start(audioContext.currentTime + i * 0.05);
                        osc.stop(audioContext.currentTime + 0.3);
                    });
                    return;
                    
                case 'correct3':
                    oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1500, audioContext.currentTime + 0.05);
                    oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.25);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.25);
                    break;
                    
                case 'wrong':
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                    
                case 'combo3':
                case 'combo5':
                    for(let i = 0; i < 3; i++) {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.value = 800 + i * 200;
                        gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.1);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.15);
                        osc.start(audioContext.currentTime + i * 0.1);
                        osc.stop(audioContext.currentTime + i * 0.1 + 0.15);
                    }
                    return;
                    
                case 'perfect':
                    [400, 500, 600, 700, 800].forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.15, audioContext.currentTime + i * 0.08);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.08 + 0.3);
                        osc.start(audioContext.currentTime + i * 0.08);
                        osc.stop(audioContext.currentTime + i * 0.08 + 0.3);
                    });
                    return;
                    
                case 'complete':
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(900, audioContext.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.25, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.4);
                    break;
            }
        }
        
        function playCorrectSound() {
            const sounds = ['correct1', 'correct2', 'correct3'];
            const randomSound = sounds[Math.floor(Math.random() * sounds.length)];
            playSound(randomSound);
        }
        
        // æ’­æ”¾é¼“åŠ±è¯­éŸ³ï¼ˆè‹±æ–‡ï¼‰
        // Date: 2026-01-18
        // Author: zhangxiaoxiao
        function playEncouragement() {
            if (!soundEnabled) return;
            
            const phrase = encouragementPhrases[Math.floor(Math.random() * encouragementPhrases.length)];
            const utterance = new SpeechSynthesisUtterance(phrase);
            utterance.lang = 'en-US';
            utterance.rate = 1.0;
            utterance.pitch = 1.1;
            utterance.volume = 0.8;
            
            // ä½¿ç”¨é€‰ä¸­çš„è‹±æ–‡è¯­éŸ³ï¼ˆå¦‚æœæœ‰ï¼‰
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }
            
            setTimeout(() => {
                speechSynthesis.speak(utterance);
            }, 200);
        }
        
        function showComboEffect(count) {
            const comboTexts = {
                3: 'ğŸ”¥ ä¸‰è¿å‡»ï¼',
                5: 'âš¡ äº”è¿å‡»ï¼',
                10: 'ğŸŒŸ åè¿å‡»ï¼',
                15: 'ğŸ† è¶…ç¥ï¼'
            };
            
            if (comboTexts[count]) {
                const badge = document.createElement('div');
                badge.className = 'combo-badge';
                badge.textContent = comboTexts[count];
                document.body.appendChild(badge);
                
                setTimeout(() => {
                    badge.remove();
                }, 1000);
            }
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('soundToggle');
            const icon = document.getElementById('soundIcon');
            
            if (soundEnabled) {
                btn.classList.remove('muted');
                icon.textContent = 'ğŸ”Š';
                playSound('correct1');
            } else {
                btn.classList.add('muted');
                icon.textContent = 'ğŸ”‡';
            }
            
            localStorage.setItem('soundEnabled', soundEnabled);
        }
        
        function loadSoundPreference() {
            const saved = localStorage.getItem('soundEnabled');
            if (saved !== null) {
                soundEnabled = saved === 'true';
                const btn = document.getElementById('soundToggle');
                const icon = document.getElementById('soundIcon');
                if (!soundEnabled) {
                    btn.classList.add('muted');
                    icon.textContent = 'ğŸ”‡';
                }
            }
        }
        
        // ==================== åŸæœ‰ä»£ç  ====================
        
        // Big English 1 å•è¯åº“ï¼ˆå®Œæ•´æ•°æ®ï¼‰
        const allWordsBook1 = [
            // å…¥é—¨å•å…ƒï¼šWelcome to Class!
            { word: 'student', phonetic: '[ËˆstuËdnt]', meaning: 'å­¦ç”Ÿ', example: 'I am a student. æˆ‘æ˜¯ä¸€åå­¦ç”Ÿã€‚', unit: 'welcome', unitName: 'å…¥é—¨å•å…ƒ' },
            { word: 'teacher', phonetic: '[ËˆtiËtÊƒÉ™(r)]', meaning: 'è€å¸ˆ', example: 'She is my teacher. å¥¹æ˜¯æˆ‘çš„è€å¸ˆã€‚', unit: 'welcome', unitName: 'å…¥é—¨å•å…ƒ' },
            { word: 'clap your hands', phonetic: '[klÃ¦p jÉ”Ë(r) hÃ¦ndz]', meaning: 'æ‹æ‰‹', example: 'Clap your hands! æ‹æ‹æ‰‹ï¼', unit: 'welcome', unitName: 'å…¥é—¨å•å…ƒ' },
            { word: 'point to the door', phonetic: '[pÉ”Éªnt tuË Ã°É™ dÉ”Ë(r)]', meaning: 'æŒ‡ç€é—¨', example: 'Point to the door. æŒ‡ç€é—¨ã€‚', unit: 'welcome', unitName: 'å…¥é—¨å•å…ƒ' },
            { word: 'raise your hand', phonetic: '[reÉªz jÉ”Ë(r) hÃ¦nd]', meaning: 'ä¸¾æ‰‹', example: 'Raise your hand! ä¸¾èµ·ä½ çš„æ‰‹ï¼', unit: 'welcome', unitName: 'å…¥é—¨å•å…ƒ' },
            { word: 'sit down', phonetic: '[sÉªt daÊŠn]', meaning: 'åä¸‹', example: 'Please sit down. è¯·åä¸‹ã€‚', unit: 'welcome', unitName: 'å…¥é—¨å•å…ƒ' },
            { word: 'stand up', phonetic: '[stÃ¦nd ÊŒp]', meaning: 'èµ·ç«‹', example: 'Stand up, please. è¯·èµ·ç«‹ã€‚', unit: 'welcome', unitName: 'å…¥é—¨å•å…ƒ' },
            { word: 'turn around', phonetic: '[tÉœËn É™ËˆraÊŠnd]', meaning: 'è½¬åœˆ', example: 'Turn around! è½¬ä¸ªåœˆï¼', unit: 'welcome', unitName: 'å…¥é—¨å•å…ƒ' },

            // ç¬¬1å•å…ƒï¼šGood Morning, Class! (æ•™å®¤ç‰©å“ä¸é¢œè‰²)
            { word: 'backpack', phonetic: '[ËˆbÃ¦kpÃ¦k]', meaning: 'ä¹¦åŒ…', example: 'This is my backpack. è¿™æ˜¯æˆ‘çš„ä¹¦åŒ…ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'book', phonetic: '[bÊŠk]', meaning: 'ä¹¦', example: 'I have a book. æˆ‘æœ‰ä¸€æœ¬ä¹¦ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'chair', phonetic: '[tÊƒeÉ™(r)]', meaning: 'æ¤…å­', example: 'Sit on the chair. ååœ¨æ¤…å­ä¸Šã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'crayon', phonetic: '[ËˆkreÉªÉ™n]', meaning: 'èœ¡ç¬”', example: 'I draw with crayons. æˆ‘ç”¨èœ¡ç¬”ç”»ç”»ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'desk', phonetic: '[desk]', meaning: 'è¯¾æ¡Œ', example: 'My desk is clean. æˆ‘çš„è¯¾æ¡Œå¾ˆå¹²å‡€ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'eraser', phonetic: '[ÉªËˆreÉªzÉ™(r)]', meaning: 'æ©¡çš®', example: 'I need an eraser. æˆ‘éœ€è¦ä¸€å—æ©¡çš®ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'marker', phonetic: '[ËˆmÉ‘ËkÉ™(r)]', meaning: 'è®°å·ç¬”', example: 'The marker is black. è®°å·ç¬”æ˜¯é»‘è‰²çš„ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'pen', phonetic: '[pen]', meaning: 'é’¢ç¬”', example: 'I write with a pen. æˆ‘ç”¨é’¢ç¬”å†™å­—ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'pencil', phonetic: '[Ëˆpensl]', meaning: 'é“…ç¬”', example: 'This is my pencil. è¿™æ˜¯æˆ‘çš„é“…ç¬”ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'ruler', phonetic: '[ËˆruËlÉ™(r)]', meaning: 'å°ºå­', example: 'I use a ruler. æˆ‘ç”¨å°ºå­ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'blue', phonetic: '[bluË]', meaning: 'è“è‰²', example: 'The sky is blue. å¤©ç©ºæ˜¯è“è‰²çš„ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'green', phonetic: '[É¡riËn]', meaning: 'ç»¿è‰²', example: 'The grass is green. è‰æ˜¯ç»¿è‰²çš„ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'red', phonetic: '[red]', meaning: 'çº¢è‰²', example: 'The apple is red. è‹¹æœæ˜¯çº¢è‰²çš„ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },
            { word: 'yellow', phonetic: '[ËˆjelÉ™ÊŠ]', meaning: 'é»„è‰²', example: 'The banana is yellow. é¦™è•‰æ˜¯é»„è‰²çš„ã€‚', unit: 'unit1', unitName: 'ç¬¬1å•å…ƒ' },

            // ç¬¬2å•å…ƒï¼šMy Family (å®¶åº­æˆå‘˜)
            { word: 'father', phonetic: '[ËˆfÉ‘ËÃ°É™(r)]', meaning: 'çˆ¶äº²', example: 'This is my father. è¿™æ˜¯æˆ‘çš„çˆ¶äº²ã€‚', unit: 'unit2', unitName: 'ç¬¬2å•å…ƒ' },
            { word: 'mother', phonetic: '[ËˆmÊŒÃ°É™(r)]', meaning: 'æ¯äº²', example: 'I love my mother. æˆ‘çˆ±æˆ‘çš„æ¯äº²ã€‚', unit: 'unit2', unitName: 'ç¬¬2å•å…ƒ' },
            { word: 'brother', phonetic: '[ËˆbrÊŒÃ°É™(r)]', meaning: 'å…„å¼Ÿ', example: 'He is my brother. ä»–æ˜¯æˆ‘çš„å…„å¼Ÿã€‚', unit: 'unit2', unitName: 'ç¬¬2å•å…ƒ' },
            { word: 'sister', phonetic: '[ËˆsÉªstÉ™(r)]', meaning: 'å§å¦¹', example: 'She is my sister. å¥¹æ˜¯æˆ‘çš„å§å¦¹ã€‚', unit: 'unit2', unitName: 'ç¬¬2å•å…ƒ' },
            { word: 'grandfather', phonetic: '[ËˆÉ¡rÃ¦nfÉ‘ËÃ°É™(r)]', meaning: 'ç¥–çˆ¶/å¤–ç¥–çˆ¶', example: 'My grandfather is kind. æˆ‘çš„ç¥–çˆ¶å¾ˆå’Œè”¼ã€‚', unit: 'unit2', unitName: 'ç¬¬2å•å…ƒ' },
            { word: 'grandmother', phonetic: '[ËˆÉ¡rÃ¦nmÊŒÃ°É™(r)]', meaning: 'ç¥–æ¯/å¤–ç¥–æ¯', example: 'I visit my grandmother. æˆ‘å»çœ‹æœ›æˆ‘çš„ç¥–æ¯ã€‚', unit: 'unit2', unitName: 'ç¬¬2å•å…ƒ' },
            { word: 'me', phonetic: '[miË]', meaning: 'æˆ‘', example: 'This is me. è¿™æ˜¯æˆ‘ã€‚', unit: 'unit2', unitName: 'ç¬¬2å•å…ƒ' },
            { word: 'photo album', phonetic: '[ËˆfÉ™ÊŠtÉ™ÊŠ ËˆÃ¦lbÉ™m]', meaning: 'ç›¸å†Œ', example: 'Look at my photo album. çœ‹çœ‹æˆ‘çš„ç›¸å†Œã€‚', unit: 'unit2', unitName: 'ç¬¬2å•å…ƒ' },

            // ç¬¬3å•å…ƒï¼šMy Body (èº«ä½“éƒ¨ä½ä¸ç‰¹å¾)
            { word: 'arm', phonetic: '[É‘Ëm]', meaning: 'æ‰‹è‡‚', example: 'I have two arms. æˆ‘æœ‰ä¸¤åªæ‰‹è‡‚ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'ear', phonetic: '[ÉªÉ™(r)]', meaning: 'è€³æœµ', example: 'I can hear with my ears. æˆ‘ç”¨è€³æœµå¬ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'eye', phonetic: '[aÉª]', meaning: 'çœ¼ç›', example: 'I have two eyes. æˆ‘æœ‰ä¸¤åªçœ¼ç›ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'fingers', phonetic: '[ËˆfÉªÅ‹É¡É™z]', meaning: 'æ‰‹æŒ‡', example: 'I have ten fingers. æˆ‘æœ‰åæ ¹æ‰‹æŒ‡ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'foot', phonetic: '[fÊŠt]', meaning: 'è„š', example: 'My foot hurts. æˆ‘çš„è„šç–¼ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'feet', phonetic: '[fiËt]', meaning: 'è„š(å¤æ•°)', example: 'I have two feet. æˆ‘æœ‰ä¸¤åªè„šã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'hand', phonetic: '[hÃ¦nd]', meaning: 'æ‰‹', example: 'Wash your hands. æ´—æ‰‹ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'hair', phonetic: '[heÉ™(r)]', meaning: 'å¤´å‘', example: 'I have long hair. æˆ‘æœ‰é•¿å¤´å‘ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'head', phonetic: '[hed]', meaning: 'å¤´', example: 'My head is big. æˆ‘çš„å¤´å¾ˆå¤§ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'leg', phonetic: '[leÉ¡]', meaning: 'è…¿', example: 'I have two legs. æˆ‘æœ‰ä¸¤æ¡è…¿ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'mouth', phonetic: '[maÊŠÎ¸]', meaning: 'å˜´', example: 'Open your mouth. å¼ å¼€ä½ çš„å˜´ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'nose', phonetic: '[nÉ™ÊŠz]', meaning: 'é¼»å­', example: 'I smell with my nose. æˆ‘ç”¨é¼»å­é—»ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'toes', phonetic: '[tÉ™ÊŠz]', meaning: 'è„šè¶¾', example: 'I have ten toes. æˆ‘æœ‰åæ ¹è„šè¶¾ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'big', phonetic: '[bÉªÉ¡]', meaning: 'å¤§çš„', example: 'The elephant is big. å¤§è±¡å¾ˆå¤§ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'long', phonetic: '[lÉ’Å‹]', meaning: 'é•¿çš„', example: 'She has long hair. å¥¹æœ‰é•¿å¤´å‘ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'short', phonetic: '[ÊƒÉ”Ët]', meaning: 'çŸ­çš„/çŸ®çš„', example: 'He is short. ä»–å¾ˆçŸ®ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },
            { word: 'small', phonetic: '[smÉ”Ël]', meaning: 'å°çš„', example: 'The mouse is small. è€é¼ å¾ˆå°ã€‚', unit: 'unit3', unitName: 'ç¬¬3å•å…ƒ' },

            // ç¬¬4å•å…ƒï¼šMy Favorite Clothes! (è¡£æœä¸å½¢å®¹è¯)
            { word: 'blouse', phonetic: '[blaÊŠz]', meaning: 'å¥³è¡¬è¡«', example: 'She wears a blouse. å¥¹ç©¿ç€å¥³è¡¬è¡«ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'boots', phonetic: '[buËts]', meaning: 'é´å­', example: 'I like my boots. æˆ‘å–œæ¬¢æˆ‘çš„é´å­ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'dress', phonetic: '[dres]', meaning: 'è¿è¡£è£™', example: 'She has a pretty dress. å¥¹æœ‰ä¸€æ¡æ¼‚äº®çš„è¿è¡£è£™ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'gloves', phonetic: '[É¡lÊŒvz]', meaning: 'æ‰‹å¥—', example: 'I wear gloves in winter. æˆ‘å†¬å¤©æˆ´æ‰‹å¥—ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'hat', phonetic: '[hÃ¦t]', meaning: 'å¸½å­', example: 'I have a red hat. æˆ‘æœ‰ä¸€é¡¶çº¢è‰²çš„å¸½å­ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'jacket', phonetic: '[ËˆdÊ’Ã¦kÉªt]', meaning: 'å¤¹å…‹', example: 'This is my jacket. è¿™æ˜¯æˆ‘çš„å¤¹å…‹ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'pants', phonetic: '[pÃ¦nts]', meaning: 'è£¤å­', example: 'He wears blue pants. ä»–ç©¿è“è‰²è£¤å­ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'shirt', phonetic: '[ÊƒÉœËt]', meaning: 'ç”·è¡¬è¡«', example: 'I like this shirt. æˆ‘å–œæ¬¢è¿™ä»¶è¡¬è¡«ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'shoes', phonetic: '[ÊƒuËz]', meaning: 'é‹å­', example: 'My shoes are new. æˆ‘çš„é‹å­æ˜¯æ–°çš„ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'shorts', phonetic: '[ÊƒÉ”Ëts]', meaning: 'çŸ­è£¤', example: 'I wear shorts in summer. æˆ‘å¤å¤©ç©¿çŸ­è£¤ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'skirt', phonetic: '[skÉœËt]', meaning: 'åŠèº«è£™', example: 'She has a yellow skirt. å¥¹æœ‰ä¸€æ¡é»„è‰²çš„åŠèº«è£™ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'T-shirt', phonetic: '[ËˆtiË ÊƒÉœËt]', meaning: 'ä½“æ¤è¡«', example: 'I wear a T-shirt. æˆ‘ç©¿ä½“æ¤è¡«ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'new', phonetic: '[njuË]', meaning: 'æ–°çš„', example: 'This is my new bag. è¿™æ˜¯æˆ‘çš„æ–°åŒ…ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },
            { word: 'old', phonetic: '[É™ÊŠld]', meaning: 'æ—§çš„', example: 'This is my old toy. è¿™æ˜¯æˆ‘çš„æ—§ç©å…·ã€‚', unit: 'unit4', unitName: 'ç¬¬4å•å…ƒ' },

            // ç¬¬5å•å…ƒï¼šBusy at Home (å®¶å±…æ´»åŠ¨ä¸æˆ¿é—´)
            { word: 'brushing my teeth', phonetic: '[ËˆbrÊŒÊƒÉªÅ‹ maÉª tiËÎ¸]', meaning: 'åˆ·ç‰™', example: 'I am brushing my teeth. æˆ‘åœ¨åˆ·ç‰™ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'combing my hair', phonetic: '[ËˆkÉ™ÊŠmÉªÅ‹ maÉª heÉ™(r)]', meaning: 'æ¢³å¤´', example: 'She is combing her hair. å¥¹åœ¨æ¢³å¤´ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'drawing', phonetic: '[ËˆdrÉ”ËÉªÅ‹]', meaning: 'ç”»ç”»', example: 'I am drawing a picture. æˆ‘åœ¨ç”»ç”»ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'drinking', phonetic: '[ËˆdrÉªÅ‹kÉªÅ‹]', meaning: 'å–', example: 'He is drinking water. ä»–åœ¨å–æ°´ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'eating', phonetic: '[ËˆiËtÉªÅ‹]', meaning: 'åƒ', example: 'I am eating breakfast. æˆ‘åœ¨åƒæ—©é¤ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'making lunch', phonetic: '[ËˆmeÉªkÉªÅ‹ lÊŒntÊƒ]', meaning: 'åšåˆé¥­', example: 'Mom is making lunch. å¦ˆå¦ˆåœ¨åšåˆé¥­ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'playing', phonetic: '[ËˆpleÉªÉªÅ‹]', meaning: 'ç©è€', example: 'I am playing games. æˆ‘åœ¨ç©æ¸¸æˆã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'reading', phonetic: '[ËˆriËdÉªÅ‹]', meaning: 'é˜…è¯»', example: 'She is reading a book. å¥¹åœ¨è¯»ä¹¦ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'taking a bath', phonetic: '[ËˆteÉªkÉªÅ‹ É™ bÉ‘ËÎ¸]', meaning: 'æ´—æ¾¡', example: 'I am taking a bath. æˆ‘åœ¨æ´—æ¾¡ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'talking on the phone', phonetic: '[ËˆtÉ”ËkÉªÅ‹ É’n Ã°É™ fÉ™ÊŠn]', meaning: 'æ‰“ç”µè¯', example: 'Dad is talking on the phone. çˆ¸çˆ¸åœ¨æ‰“ç”µè¯ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'washing', phonetic: '[ËˆwÉ’ÊƒÉªÅ‹]', meaning: 'æ´—', example: 'I am washing my hands. æˆ‘åœ¨æ´—æ‰‹ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'watching TV', phonetic: '[ËˆwÉ’tÊƒÉªÅ‹ ËŒtiËËˆviË]', meaning: 'çœ‹ç”µè§†', example: 'We are watching TV. æˆ‘ä»¬åœ¨çœ‹ç”µè§†ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'bathroom', phonetic: '[ËˆbÉ‘ËÎ¸ruËm]', meaning: 'æµ´å®¤', example: 'The bathroom is clean. æµ´å®¤å¾ˆå¹²å‡€ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'bedroom', phonetic: '[ËˆbedruËm]', meaning: 'å§å®¤', example: 'This is my bedroom. è¿™æ˜¯æˆ‘çš„å§å®¤ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'kitchen', phonetic: '[ËˆkÉªtÊƒÉªn]', meaning: 'å¨æˆ¿', example: 'Mom is in the kitchen. å¦ˆå¦ˆåœ¨å¨æˆ¿ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },
            { word: 'living room', phonetic: '[ËˆlÉªvÉªÅ‹ ruËm]', meaning: 'å®¢å…', example: 'We watch TV in the living room. æˆ‘ä»¬åœ¨å®¢å…çœ‹ç”µè§†ã€‚', unit: 'unit5', unitName: 'ç¬¬5å•å…ƒ' },

            // ç¬¬6å•å…ƒï¼šOn the Farm (å†œåœºåŠ¨ç‰©)
            { word: 'bird', phonetic: '[bÉœËd]', meaning: 'é¸Ÿ', example: 'The bird is singing. é¸Ÿå„¿åœ¨å”±æ­Œã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'cat', phonetic: '[kÃ¦t]', meaning: 'çŒ«', example: 'I have a cat. æˆ‘æœ‰ä¸€åªçŒ«ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'chicken', phonetic: '[ËˆtÊƒÉªkÉªn]', meaning: 'é¸¡', example: 'The chicken lays eggs. é¸¡ä¸‹è›‹ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'cow', phonetic: '[kaÊŠ]', meaning: 'å¥¶ç‰›', example: 'The cow gives milk. å¥¶ç‰›äº§å¥¶ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'dog', phonetic: '[dÉ’É¡]', meaning: 'ç‹—', example: 'My dog is friendly. æˆ‘çš„ç‹—å¾ˆå‹å¥½ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'donkey', phonetic: '[ËˆdÉ’Å‹ki]', meaning: 'é©´', example: 'The donkey is strong. é©´å¾ˆå¼ºå£®ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'duck', phonetic: '[dÊŒk]', meaning: 'é¸­å­', example: 'The duck swims in the pond. é¸­å­åœ¨æ± å¡˜é‡Œæ¸¸æ³³ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'farm', phonetic: '[fÉ‘Ëm]', meaning: 'å†œåœº', example: 'I live on a farm. æˆ‘ä½åœ¨å†œåœºã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'goat', phonetic: '[É¡É™ÊŠt]', meaning: 'å±±ç¾Š', example: 'The goat eats grass. å±±ç¾Šåƒè‰ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'horse', phonetic: '[hÉ”Ës]', meaning: 'é©¬', example: 'I ride a horse. æˆ‘éª‘é©¬ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'pig', phonetic: '[pÉªÉ¡]', meaning: 'çŒª', example: 'The pig is pink. çŒªæ˜¯ç²‰çº¢è‰²çš„ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'rabbit', phonetic: '[ËˆrÃ¦bÉªt]', meaning: 'å…”å­', example: 'The rabbit is hopping. å…”å­åœ¨è·³ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'sheep', phonetic: '[ÊƒiËp]', meaning: 'ç»µç¾Š', example: 'The sheep has wool. ç»µç¾Šæœ‰ç¾Šæ¯›ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'turtle', phonetic: '[ËˆtÉœËtl]', meaning: 'ä¹Œé¾Ÿ', example: 'The turtle is slow. ä¹Œé¾Ÿå¾ˆæ…¢ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'fast', phonetic: '[fÉ‘Ëst]', meaning: 'å¿«çš„', example: 'The horse runs fast. é©¬è·‘å¾—å¿«ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },
            { word: 'slow', phonetic: '[slÉ™ÊŠ]', meaning: 'æ…¢çš„', example: 'The turtle moves slow. ä¹Œé¾Ÿç§»åŠ¨å¾—æ…¢ã€‚', unit: 'unit6', unitName: 'ç¬¬6å•å…ƒ' },

            // ç¬¬7å•å…ƒï¼šParty Time (é£Ÿç‰©ä¸æ•°å­—)
            { word: 'apple', phonetic: '[ËˆÃ¦pl]', meaning: 'è‹¹æœ', example: 'I like apples. æˆ‘å–œæ¬¢è‹¹æœã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'banana', phonetic: '[bÉ™ËˆnÉ‘ËnÉ™]', meaning: 'é¦™è•‰', example: 'The banana is yellow. é¦™è•‰æ˜¯é»„è‰²çš„ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'cake', phonetic: '[keÉªk]', meaning: 'è›‹ç³•', example: 'This is my birthday cake. è¿™æ˜¯æˆ‘çš„ç”Ÿæ—¥è›‹ç³•ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'candy', phonetic: '[ËˆkÃ¦ndi]', meaning: 'ç³–æœ', example: 'I love candy. æˆ‘å–œæ¬¢ç³–æœã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'cookie', phonetic: '[ËˆkÊŠki]', meaning: 'é¥¼å¹²', example: 'Can I have a cookie? æˆ‘å¯ä»¥åƒé¥¼å¹²å—ï¼Ÿ', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'grapes', phonetic: '[É¡reÉªps]', meaning: 'è‘¡è„', example: 'Grapes are sweet. è‘¡è„å¾ˆç”œã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'ice cream', phonetic: '[ËˆaÉªs kriËm]', meaning: 'å†°æ·‡æ·‹', example: 'I want ice cream. æˆ‘æƒ³åƒå†°æ·‡æ·‹ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'juice', phonetic: '[dÊ’uËs]', meaning: 'æœæ±', example: 'I drink orange juice. æˆ‘å–æ©™æ±ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'milk', phonetic: '[mÉªlk]', meaning: 'ç‰›å¥¶', example: 'I drink milk every day. æˆ‘æ¯å¤©å–ç‰›å¥¶ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'orange', phonetic: '[ËˆÉ’rÉªndÊ’]', meaning: 'æ©™å­', example: 'Oranges are juicy. æ©™å­å¤šæ±ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'pizza', phonetic: '[ËˆpiËtsÉ™]', meaning: 'æ¯”è¨', example: 'I like pizza. æˆ‘å–œæ¬¢æ¯”è¨ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'sandwich', phonetic: '[ËˆsÃ¦nwÉªdÊ’]', meaning: 'ä¸‰æ˜æ²»', example: 'This is my sandwich. è¿™æ˜¯æˆ‘çš„ä¸‰æ˜æ²»ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'watermelon', phonetic: '[ËˆwÉ”ËtÉ™melÉ™n]', meaning: 'è¥¿ç“œ', example: 'Watermelon is big. è¥¿ç“œå¾ˆå¤§ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'one', phonetic: '[wÊŒn]', meaning: 'ä¸€', example: 'I have one apple. æˆ‘æœ‰ä¸€ä¸ªè‹¹æœã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'two', phonetic: '[tuË]', meaning: 'äºŒ', example: 'I see two birds. æˆ‘çœ‹åˆ°ä¸¤åªé¸Ÿã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'three', phonetic: '[Î¸riË]', meaning: 'ä¸‰', example: 'I have three pencils. æˆ‘æœ‰ä¸‰æ”¯é“…ç¬”ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'four', phonetic: '[fÉ”Ë(r)]', meaning: 'å››', example: 'There are four chairs. æœ‰å››æŠŠæ¤…å­ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'five', phonetic: '[faÉªv]', meaning: 'äº”', example: 'I am five years old. æˆ‘äº”å²äº†ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'six', phonetic: '[sÉªks]', meaning: 'å…­', example: 'I have six crayons. æˆ‘æœ‰å…­æ”¯èœ¡ç¬”ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },
            { word: 'seven', phonetic: '[Ëˆsevn]', meaning: 'ä¸ƒ', example: 'There are seven days in a week. ä¸€å‘¨æœ‰ä¸ƒå¤©ã€‚', unit: 'unit7', unitName: 'ç¬¬7å•å…ƒ' },

            // ç¬¬8å•å…ƒï¼šFun and Games (ç©å…·ä¸æ´»åŠ¨)
            { word: 'ball', phonetic: '[bÉ”Ël]', meaning: 'çƒ', example: 'I play with a ball. æˆ‘ç©çƒã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'bike', phonetic: '[baÉªk]', meaning: 'è‡ªè¡Œè½¦', example: 'I ride my bike. æˆ‘éª‘è‡ªè¡Œè½¦ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'blocks', phonetic: '[blÉ’ks]', meaning: 'ç§¯æœ¨', example: 'I build with blocks. æˆ‘ç”¨ç§¯æœ¨æ­å»ºã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'doll', phonetic: '[dÉ’l]', meaning: 'ç©å¶', example: 'She has a doll. å¥¹æœ‰ä¸€ä¸ªç©å¶ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'game', phonetic: '[É¡eÉªm]', meaning: 'æ¸¸æˆ', example: 'Let\'s play a game. æˆ‘ä»¬æ¥ç©æ¸¸æˆå§ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'jump rope', phonetic: '[dÊ’ÊŒmp rÉ™ÊŠp]', meaning: 'è·³ç»³', example: 'I like jump rope. æˆ‘å–œæ¬¢è·³ç»³ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'kite', phonetic: '[kaÉªt]', meaning: 'é£ç­', example: 'I fly a kite. æˆ‘æ”¾é£ç­ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'puzzle', phonetic: '[ËˆpÊŒzl]', meaning: 'æ‹¼å›¾', example: 'I do a puzzle. æˆ‘åšæ‹¼å›¾ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'robot', phonetic: '[ËˆrÉ™ÊŠbÉ’t]', meaning: 'æœºå™¨äºº', example: 'I have a toy robot. æˆ‘æœ‰ä¸€ä¸ªç©å…·æœºå™¨äººã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'scooter', phonetic: '[ËˆskuËtÉ™(r)]', meaning: 'æ»‘æ¿è½¦', example: 'I ride a scooter. æˆ‘éª‘æ»‘æ¿è½¦ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'teddy bear', phonetic: '[Ëˆtedi beÉ™(r)]', meaning: 'æ³°è¿ªç†Š', example: 'I sleep with my teddy bear. æˆ‘æŠ±ç€æ³°è¿ªç†Šç¡è§‰ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'top', phonetic: '[tÉ’p]', meaning: 'é™€èº', example: 'The top spins fast. é™€èºè½¬å¾—å¾ˆå¿«ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'toy car', phonetic: '[tÉ”Éª kÉ‘Ë(r)]', meaning: 'ç©å…·è½¦', example: 'I play with my toy car. æˆ‘ç©ç©å…·è½¦ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'train', phonetic: '[treÉªn]', meaning: 'ç«è½¦', example: 'I have a toy train. æˆ‘æœ‰ä¸€è¾†ç©å…·ç«è½¦ã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'video game', phonetic: '[ËˆvÉªdiÉ™ÊŠ É¡eÉªm]', meaning: 'ç”µå­æ¸¸æˆ', example: 'I play video games. æˆ‘ç©ç”µå­æ¸¸æˆã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },
            { word: 'yo-yo', phonetic: '[ËˆjÉ™ÊŠjÉ™ÊŠ]', meaning: 'æºœæºœçƒ', example: 'I can play yo-yo. æˆ‘ä¼šç©æºœæºœçƒã€‚', unit: 'unit8', unitName: 'ç¬¬8å•å…ƒ' },

            // ç¬¬9å•å…ƒï¼šPlay Time (åŠ¨ä½œä¸ä½ç½®)
            { word: 'climb', phonetic: '[klaÉªm]', meaning: 'çˆ¬', example: 'I climb the tree. æˆ‘çˆ¬æ ‘ã€‚', unit: 'unit9', unitName: 'ç¬¬9å•å…ƒ' },
            { word: 'dance', phonetic: '[dÉ‘Ëns]', meaning: 'è·³èˆ', example: 'I like to dance. æˆ‘å–œæ¬¢è·³èˆã€‚', unit: 'unit9', unitName: 'ç¬¬9å•å…ƒ' },
            { word: 'jump', phonetic: '[dÊ’ÊŒmp]', meaning: 'è·³', example: 'I can jump high. æˆ‘èƒ½è·³å¾—å¾ˆé«˜ã€‚', unit: 'unit9', unitName: 'ç¬¬9å•å…ƒ' },
            { word: 'run', phonetic: '[rÊŒn]', meaning: 'è·‘', example: 'I run fast. æˆ‘è·‘å¾—å¿«ã€‚', unit: 'unit9', unitName: 'ç¬¬9å•å…ƒ' },
            { word: 'sing', phonetic: '[sÉªÅ‹]', meaning: 'å”±æ­Œ', example: 'I sing a song. æˆ‘å”±æ­Œã€‚', unit: 'unit9', unitName: 'ç¬¬9å•å…ƒ' },
            { word: 'swim', phonetic: '[swÉªm]', meaning: 'æ¸¸æ³³', example: 'I swim in the pool. æˆ‘åœ¨æ³³æ± é‡Œæ¸¸æ³³ã€‚', unit: 'unit9', unitName: 'ç¬¬9å•å…ƒ' },
            { word: 'walk', phonetic: '[wÉ”Ëk]', meaning: 'èµ°', example: 'I walk to school. æˆ‘èµ°è·¯å»å­¦æ ¡ã€‚', unit: 'unit9', unitName: 'ç¬¬9å•å…ƒ' },
            { word: 'in', phonetic: '[Éªn]', meaning: 'åœ¨...é‡Œé¢', example: 'The cat is in the box. çŒ«åœ¨ç›’å­é‡Œã€‚', unit: 'unit9', unitName: 'ç¬¬9å•å…ƒ' },
            { word: 'on', phonetic: '[É’n]', meaning: 'åœ¨...ä¸Šé¢', example: 'The book is on the desk. ä¹¦åœ¨æ¡Œå­ä¸Šã€‚', unit: 'unit9', unitName: 'ç¬¬9å•å…ƒ' },
            { word: 'under', phonetic: '[ËˆÊŒndÉ™(r)]', meaning: 'åœ¨...ä¸‹é¢', example: 'The dog is under the table. ç‹—åœ¨æ¡Œå­ä¸‹é¢ã€‚', unit: 'unit9', unitName: 'ç¬¬9å•å…ƒ' },
        ];

        // è·å–URLå‚æ•°ä¸­çš„æ•™æç¼–å·
        function getBookNumber() {
            const params = new URLSearchParams(window.location.search);
            return parseInt(params.get('book')) || 1;
        }

        // è·å–å½“å‰æ•™ææ•°æ®
        function getCurrentBookData() {
            const bookNumber = getBookNumber();
            
            // æ ¹æ®æ•™æç¼–å·è¿”å›å¯¹åº”æ•°æ®
            switch(bookNumber) {
                case 1:
                    // Book 1 æ•°æ®
                    return allWordsBook1;
                    
                case 2:
                    // Book 2 æ•°æ®
                    if (typeof book2Vocabulary !== 'undefined') {
                        document.title = 'Big English 2 å•è¯é»˜å†™';
                        const header = document.querySelector('.header h1');
                        if (header) header.textContent = 'âœï¸ Big English 2 å•è¯é»˜å†™';
                        return book2Vocabulary;
                    }
                    break;
                    
                case 3:
                    // Book 3 æ•°æ®
                    if (typeof book3Vocabulary !== 'undefined') {
                        document.title = 'Big English 3 å•è¯é»˜å†™';
                        const header = document.querySelector('.header h1');
                        if (header) header.textContent = 'âœï¸ Big English 3 å•è¯é»˜å†™';
                        return book3Vocabulary;
                    }
                    break;
                    
                case 4:
                    // Book 4 æ•°æ®
                    if (typeof book4Vocabulary !== 'undefined') {
                        document.title = 'Big English 4 å•è¯é»˜å†™';
                        const header = document.querySelector('.header h1');
                        if (header) header.textContent = 'âœï¸ Big English 4 å•è¯é»˜å†™';
                        return book4Vocabulary;
                    }
                    break;
                    
                case 5:
                    // Book 5 æ•°æ®
                    if (typeof book5Vocabulary !== 'undefined') {
                        document.title = 'Big English 5 å•è¯é»˜å†™';
                        const header = document.querySelector('.header h1');
                        if (header) header.textContent = 'âœï¸ Big English 5 å•è¯é»˜å†™';
                        return book5Vocabulary;
                    }
                    break;
                    
                case 6:
                    // Book 6 æ•°æ®
                    if (typeof book6Vocabulary !== 'undefined') {
                        document.title = 'Big English 6 å•è¯é»˜å†™';
                        const header = document.querySelector('.header h1');
                        if (header) header.textContent = 'âœï¸ Big English 6 å•è¯é»˜å†™';
                        return book6Vocabulary;
                    }
                    break;
            }
            
            // é»˜è®¤è¿”å› Book 1
            return allWordsBook1;
        }

        // ä½¿ç”¨å½“å‰æ•™æçš„æ•°æ®
        const allWords = getCurrentBookData();

        // å„æ•™æå•å…ƒæ ‡é¢˜é…ç½®ï¼ˆä» key_words_N.txt æå–ï¼‰
        const unitTitles = {
            1: {
                welcome: 'Welcome to Class!',
                unit1: 'Good Morning, Class!',
                unit2: 'My Family',
                unit3: 'My Body',
                unit4: 'My Favorite Clothes!',
                unit5: 'Busy at Home',
                unit6: 'On the Farm',
                unit7: 'Party Time',
                unit8: 'Fun and Games',
                unit9: 'Play Time'
            },
            2: {
                welcome: 'Welcome to Class!',
                unit1: 'In My Classroom',
                unit2: 'My Games',
                unit3: 'In My House',
                unit4: 'In My Town',
                unit5: 'My Dream Job',
                unit6: 'My Day',
                unit7: 'My Favorite Food',
                unit8: 'Wild Animals',
                unit9: 'Special Days'
            },
            3: {
                welcome: 'Welcome to Class!',
                unit1: 'Wake Up!',
                unit2: 'A Lot of Jobs!',
                unit3: 'Working Hard!',
                unit4: 'Amazing Animals',
                unit5: 'Wonderful Weather!',
                unit6: 'Smells Good!',
                unit7: 'Fabulous Food!',
                unit8: 'Healthy Living',
                unit9: 'School Trips!'
            },
            4: {
                welcome: 'Welcome to Class!',
                unit1: 'Kids in My Class',
                unit2: 'Spending Money',
                unit3: 'Food Around the World',
                unit4: 'How Do You Feel?',
                unit5: 'Weird and Wild Animals',
                unit6: 'Life Long Ago',
                unit7: 'Special Days',
                unit8: 'Hobbies',
                unit9: 'Learning New Things'
            },
            5: {
                welcome: 'Welcome to Class!',
                unit1: 'My Interests',
                unit2: 'Family Ties',
                unit3: 'Helping Others',
                unit4: 'Shopping Around',
                unit5: 'Vacation Time',
                unit6: 'The Future',
                unit7: 'What\'s It Worth?',
                unit8: 'Where Do They Come From?',
                unit9: 'How Adventurous Are You?'
            },
            6: {
                welcome: 'Welcome to Class!',
                unit1: 'All About School',
                unit2: 'Amazing Young People',
                unit3: 'Dilemmas',
                unit4: 'Future Me',
                unit5: 'If I Could Fly...',
                unit6: 'The Coolest School Subjects',
                unit7: 'Mysteries!',
                unit8: 'Why Is It Famous?',
                unit9: 'That\'s Entertainment!'
            }
        };
        
        // è·å–å½“å‰æ•™æç¼–å·
        const currentBookNumber = getBookNumber();

        // åŠ¨æ€ç”Ÿæˆå•å…ƒé€‰æ‹©å™¨ï¼ˆæ”¹ä¸ºæŒ‰é’®å½¢å¼ï¼‰
        function populateUnitSelector() {
            const unitButtons = document.getElementById('unitButtons');
            
            // ç»Ÿè®¡æ¯ä¸ªå•å…ƒçš„å•è¯æ•°
            const unitCounts = {};
            allWords.forEach(word => {
                if (!unitCounts[word.unit]) {
                    unitCounts[word.unit] = {
                        name: word.unitName,
                        count: 0
                    };
                }
                unitCounts[word.unit].count++;
            });
            
            // è·å–å½“å‰æ•™æçš„å•å…ƒæ ‡é¢˜
            const titles = unitTitles[currentBookNumber] || unitTitles[1];
            
            // ç”ŸæˆæŒ‰é’®
            let html = `<button class="unit-btn all-units active" onclick="selectUnitButton('all')">æ‰€æœ‰å•å…ƒ (${allWords.length}ä¸ª)</button>`;
            
            // æŒ‰å•å…ƒé¡ºåºæ·»åŠ æŒ‰é’®
            const units = ['welcome', 'unit1', 'unit2', 'unit3', 'unit4', 'unit5', 'unit6', 'unit7', 'unit8', 'unit9'];
            units.forEach(unitKey => {
                if (unitCounts[unitKey]) {
                    const unitName = unitCounts[unitKey].name;
                    const count = unitCounts[unitKey].count;
                    const title = titles[unitKey] || '';
                    const displayName = title ? `${unitName} - ${title} (${count}ä¸ª)` : `${unitName} (${count}ä¸ª)`;
                    html += `<button class="unit-btn" onclick="selectUnitButton('${unitKey}')">${displayName}</button>`;
                }
            });
            
            unitButtons.innerHTML = html;
        }
        
        // é€‰æ‹©å•å…ƒæŒ‰é’®
        function selectUnitButton(unit) {
            selectedUnit = unit;
            
            // æ›´æ–°æŒ‰é’®æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.unit-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–å•å…ƒé€‰æ‹©å™¨
        populateUnitSelector();

        // å…¨å±€çŠ¶æ€
        let currentWords = [];
        let currentIndex = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let mistakes = [];
        let mode = 'sequential';
        let phoneticVisible = false;
        let exampleVisible = false;
        let selectedUnit = 'all';
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;

        // åˆå§‹åŒ–
        function init() {
            // åŠ è½½é”™é¢˜æ•°æ®
            mistakes = loadMistakes();
            
            updateHistoryWrongCount(); // åŠ è½½å¹¶æ˜¾ç¤ºå†å²é”™é¢˜æ•°é‡
            
            // ä» URL è¯»å–å‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            const unitParam = urlParams.get('unit');
            const modeParam = urlParams.get('mode');
            
            if (unitParam) {
                selectedUnit = unitParam;
            }
            
            // å¦‚æœæ˜¯é”™é¢˜ç»ƒä¹ æ¨¡å¼
            if (modeParam === 'mistakes') {
                // éšè—"æœ¬æ¬¡æ–°å¢"ç»Ÿè®¡é¡¹ï¼ˆé”™é¢˜ç»ƒä¹ æ¨¡å¼ä¸‹æ— æ„ä¹‰ï¼‰
                const currentWrongItem = document.getElementById('currentWrongItem');
                if (currentWrongItem) {
                    currentWrongItem.style.display = 'none';
                }
                
                // å¼€å§‹é”™é¢˜ç»ƒä¹ 
                startDictation('mistakes');
            } else {
                // è‡ªåŠ¨å¼€å§‹é»˜å†™ï¼ˆé¡ºåºæ¨¡å¼ï¼‰
                startDictation('sequential');
            }
        }

        // é€‰æ‹©å•å…ƒ
        // ä¿ç•™æ—§çš„ selectUnit å‡½æ•°ç”¨äºå…¼å®¹
        function selectUnit() {
            // ç”±äºæ”¹ä¸ºæŒ‰é’®ï¼Œè¿™ä¸ªå‡½æ•°å¯èƒ½ä¸å†éœ€è¦
            // ä½†ä¿ç•™ä»¥é˜²å…¶ä»–åœ°æ–¹è°ƒç”¨
            resetDictation();
        }

        // å¼€å§‹é»˜å†™
        function startDictation(dictationMode) {
            mode = dictationMode;
            
            // é€‰æ‹©è¯æ±‡
            if (mode === 'mistakes') {
                if (mistakes.length === 0) {
                    alert('æš‚æ— é”™é¢˜ï¼');
                    return;
                }
                currentWords = [...mistakes];
                
                // éšè—"æœ¬æ¬¡æ–°å¢"ç»Ÿè®¡é¡¹ï¼ˆé”™é¢˜ç»ƒä¹ æ¨¡å¼ä¸‹æ— æ„ä¹‰ï¼‰
                const currentWrongItem = document.getElementById('currentWrongItem');
                if (currentWrongItem) {
                    currentWrongItem.style.display = 'none';
                }
            } else {
                if (selectedUnit === 'all') {
                    currentWords = [...allWords];
                } else {
                    currentWords = allWords.filter(w => w.unit === selectedUnit);
                }
            }

            // éšæœºæ¨¡å¼æ‰“ä¹±é¡ºåº
            if (mode === 'random') {
                currentWords = shuffleArray(currentWords);
            }

            // é‡ç½®ç»Ÿè®¡
            currentIndex = 0;
            correctCount = 0;
            wrongCount = 0;
            phoneticVisible = false;

            // æ˜¾ç¤ºç¬¬ä¸€ä¸ªå•è¯
            document.getElementById('dictationCard').style.display = 'flex';
            document.getElementById('completionScreen').classList.remove('show');
            displayCurrentWord();
            updateStats();
            
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            updatePageTitle();
        }

        // æ›´æ–°é¡µé¢æ ‡é¢˜ï¼Œæ˜¾ç¤ºè¯¦ç»†çš„å­¦ä¹ ä¿¡æ¯
        function updatePageTitle() {
            // è·å–æ•™æç¼–å·
            const bookNumber = getBookNumber();
            
            // èŒƒå›´æ–‡æœ¬
            let rangeText = '';
            if (mode === 'mistakes') {
                rangeText = ' Â· é”™é¢˜ç»ƒä¹ ';
            } else if (selectedUnit === 'all') {
                rangeText = ' Â· å…¨éƒ¨å•å…ƒ';
            } else {
                // ä½¿ç”¨ unitTitles è·å–å®Œæ•´çš„å•å…ƒåç§°
                const unitTitle = unitTitles[bookNumber] && unitTitles[bookNumber][selectedUnit];
                if (unitTitle) {
                    // æ ¼å¼åŒ–å•å…ƒæ ‡é¢˜ï¼Œç¡®ä¿æœ‰ "Unit X: " å‰ç¼€
                    if (selectedUnit === 'welcome') {
                        rangeText = ` Â· ${unitTitle}`;
                    } else {
                        // æå–å•å…ƒç¼–å·
                        const unitNumber = selectedUnit.replace('unit', '');
                        rangeText = ` Â· Unit ${unitNumber}: ${unitTitle}`;
                    }
                } else {
                    rangeText = ` Â· ${selectedUnit}`;
                }
            }
            
            // ç»„åˆæ ‡é¢˜ - æ ¼å¼ï¼šBig English Book N Â· Unit X: ä¸»é¢˜
            const title = `Big English Book ${bookNumber}${rangeText}`;
            document.getElementById('pageTitle').textContent = title;
            
            // åŒæ—¶æ›´æ–°æµè§ˆå™¨æ ‡é¢˜
            document.title = `Big English Book ${bookNumber}${rangeText}`;
        }

        // æ˜¾ç¤ºå½“å‰å•è¯ï¼ˆè‡ªæˆ‘è¯„ä¼°æ¨¡å¼ï¼‰
        function displayCurrentWord() {
            if (currentIndex >= currentWords.length) {
                showCompletionScreen();
                return;
            }

            const word = currentWords[currentIndex];
            
            // æ›´æ–°é¢˜ç›®ä¿¡æ¯
            if (mode === 'mistakes') {
                // é”™é¢˜æ¨¡å¼ï¼šæ˜¾ç¤ºå‰©ä½™é¢˜æ•°
                document.getElementById('questionNumber').textContent = `å‰©ä½™ ${currentWords.length} é¢˜`;
            } else {
                // æ­£å¸¸æ¨¡å¼ï¼šæ˜¾ç¤ºå½“å‰é¢˜å·å’Œæ€»æ•°
                document.getElementById('questionNumber').textContent = `ç¬¬ ${currentIndex + 1} é¢˜ / å…± ${currentWords.length} é¢˜`;
            }
            
            document.getElementById('wordMeaning').textContent = word.meaning;
            document.getElementById('firstLetter').textContent = word.word[0].toLowerCase();
            document.getElementById('wordLength').textContent = word.word.replace(/\s/g, '').length; // å»é™¤ç©ºæ ¼è®¡ç®—å­—æ¯æ•°
            
            // æ˜¾ç¤ºéŸ³æ ‡
            if (word.phonetic) {
                document.getElementById('phoneticDisplay').textContent = word.phonetic;
            } else {
                document.getElementById('phoneticDisplay').textContent = 'â™ª å¬å‘éŸ³';
            }
            
            document.getElementById('answerText').textContent = word.word;
            
            // éšè—ç­”æ¡ˆåŒºåŸŸ
            document.getElementById('answerArea').style.display = 'none';
            document.getElementById('showAnswerBtn').style.display = 'inline-block';
            
            updateStats();
            
            // è‡ªåŠ¨æ’­æ”¾å‘éŸ³
            setTimeout(() => speakWord(), 500);
        }

        // å¤„ç†è¾“å…¥
        function handleInput(e) {
            const input = e.target.value.toLowerCase();
            const word = currentWords[currentIndex].word.toLowerCase();
            
            // æ›´æ–°å­—æ¯ç©ºæ ¼
            const blanksContainer = document.getElementById('letterBlanks');
            const blanks = blanksContainer.children;
            
            let inputIndex = 0;  // ç”¨æˆ·è¾“å…¥çš„ç´¢å¼•ï¼ˆåŒ…å«ç©ºæ ¼ï¼‰
            
            // éå†æ‰€æœ‰æ–¹æ¡†ï¼ˆåŒ…æ‹¬word-spaceï¼‰
            for (let i = 0; i < blanks.length; i++) {
                const blank = blanks[i];
                
                // å¦‚æœæ˜¯å•è¯é—´éš”
                if (blank.classList.contains('word-space')) {
                    // æ£€æŸ¥ç”¨æˆ·è¾“å…¥ä¸­å¯¹åº”ä½ç½®æ˜¯å¦æ˜¯ç©ºæ ¼
                    if (inputIndex < input.length && input[inputIndex] === ' ') {
                        inputIndex++; // è·³è¿‡ç”¨æˆ·è¾“å…¥çš„ç©ºæ ¼
                    }
                    continue; // è·³è¿‡word-spaceï¼Œä¸å¡«å……å†…å®¹
                }
                
                // å¤„ç†å­—æ¯æ–¹æ¡†
                if (inputIndex < input.length) {
                    const inputChar = input[inputIndex];
                    const correctChar = word[inputIndex];
                    
                    // å¦‚æœç”¨æˆ·è¾“å…¥çš„æ˜¯ç©ºæ ¼ï¼Œä¹Ÿè·³è¿‡
                    if (inputChar === ' ') {
                        inputIndex++;
                        blank.textContent = '';
                        blank.className = 'letter-blank';
                        continue;
                    }
                    
                    blank.textContent = inputChar.toUpperCase();
                    blank.classList.add('filled');
                    
                    if (inputChar === correctChar) {
                        blank.className = 'letter-blank filled correct';
                    } else {
                        blank.className = 'letter-blank filled wrong';
                    }
                    inputIndex++;
                } else {
                    blank.textContent = '';
                    blank.className = 'letter-blank';
                }
            }

            // å®Œæ•´è¾“å…¥åä¸å†è‡ªåŠ¨æ£€æŸ¥ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»æ£€æŸ¥
            // if (input.length === word.length) {
            //     setTimeout(() => checkAnswer(), 300);
            // }
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const input = document.getElementById('wordInput').value.trim().toLowerCase();
            const word = currentWords[currentIndex];
            const correctWord = word.word.toLowerCase();

            const feedback = document.getElementById('feedback');
            const inputField = document.getElementById('wordInput');

            if (!input) {
                alert('è¯·å…ˆè¾“å…¥å•è¯ï¼');
                return;
            }

            if (input === correctWord) {
                // æ­£ç¡®
                correctCount++;
                comboCount++; // å¢åŠ è¿å‡»è®¡æ•°
                
                // æ’­æ”¾éŸ³æ•ˆå’Œé¼“åŠ±
                playCorrectSound();
                playEncouragement();
                
                // æ£€æŸ¥è¿å‡»
                if (comboCount === 3) {
                    playSound('combo3');
                    showComboEffect(3);
                } else if (comboCount === 5) {
                    playSound('combo5');
                    showComboEffect(5);
                } else if (comboCount === 10) {
                    showComboEffect(10);
                } else if (comboCount === 15) {
                    showComboEffect(15);
                }
                
                feedback.textContent = 'âœ… æ­£ç¡®ï¼åšå¾—å¥½ï¼';
                feedback.className = 'feedback correct show';
                inputField.className = 'correct';
                inputField.disabled = true; // ç¦ç”¨è¾“å…¥æ¡†
                
                // éšè—æ£€æŸ¥ç­”æ¡ˆæŒ‰é’®ï¼Œæ˜¾ç¤ºä¸‹ä¸€é¢˜æŒ‰é’®
                document.getElementById('checkBtn').style.display = 'none';
                document.getElementById('skipBtn').style.display = 'none';
                document.getElementById('showAnswerBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                
                // å¯é€‰ï¼šè‡ªåŠ¨è·³è½¬ï¼ˆç»™ç”¨æˆ·ä¸€ç‚¹æ—¶é—´çœ‹åé¦ˆï¼‰
                // setTimeout(() => {
                //     currentIndex++;
                //     showCurrentWord();
                // }, 1500);
            } else {
                // é”™è¯¯
                wrongCount++;
                comboCount = 0; // é‡ç½®è¿å‡»
                
                // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
                playSound('wrong');
                
                feedback.textContent = `âŒ é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${word.word}`;
                feedback.className = 'feedback wrong show';
                inputField.className = 'wrong';
                inputField.disabled = true; // ç¦ç”¨è¾“å…¥æ¡†

                // éšè—æ£€æŸ¥ç­”æ¡ˆæŒ‰é’®ï¼Œæ˜¾ç¤ºä¸‹ä¸€é¢˜æŒ‰é’®
                document.getElementById('checkBtn').style.display = 'none';
                document.getElementById('skipBtn').style.display = 'none';
                document.getElementById('showAnswerBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';

                // æ·»åŠ åˆ°é”™é¢˜æœ¬
                const existingMistake = mistakes.find(m => m.word === word.word);
                if (!existingMistake) {
                    mistakes.push({
                        ...word,
                        wrongAnswer: input
                    });
                }

                // å¯é€‰ï¼šè‡ªåŠ¨è·³è½¬ï¼ˆç»™ç”¨æˆ·æ›´å¤šæ—¶é—´çœ‹æ­£ç¡®ç­”æ¡ˆï¼‰
                // setTimeout(() => {
                //     currentIndex++;
                //     showCurrentWord();
                // }, 2500);
            }

            updateStats();
            updateMistakeList();
        }

        // æ˜¾ç¤ºéŸ³æ ‡
        function togglePhonetic() {
            phoneticVisible = !phoneticVisible;
            document.getElementById('phoneticHint').style.display = phoneticVisible ? 'block' : 'none';
        }

        // æ˜¾ç¤ºä¾‹å¥
        function toggleExample() {
            exampleVisible = !exampleVisible;
            document.getElementById('exampleHint').style.display = exampleVisible ? 'block' : 'none';
        }

        // å‘éŸ³åŠŸèƒ½
        // æ’­æ”¾è‹±æ–‡å•è¯å‘éŸ³
        // Date: 2026-01-18
        // Author: zhangxiaoxiao
        function speakWord() {
            if (!currentWords.length || currentIndex >= currentWords.length) return;
            
            const word = currentWords[currentIndex].word;
            
            // åœæ­¢ä¹‹å‰çš„æœ—è¯»
            if (currentUtterance) {
                speechSynthesis.cancel();
            }
            
            // åˆ›å»ºæ–°çš„æœ—è¯»
            currentUtterance = new SpeechSynthesisUtterance(word);
            currentUtterance.lang = 'en-US'; // è®¾ç½®è‹±è¯­
            currentUtterance.rate = 0.8; // ç¨æ…¢ä¸€ç‚¹ï¼Œè®©å­¦ç”Ÿå¬æ¸…æ¥š
            currentUtterance.pitch = 1.0;
            currentUtterance.volume = 1.0;
            
            // ä½¿ç”¨é€‰ä¸­çš„è¯­éŸ³ï¼ˆå¦‚æœæœ‰ï¼‰
            if (selectedVoice) {
                currentUtterance.voice = selectedVoice;
            }
            
            speechSynthesis.speak(currentUtterance);
        }

        // æ’­æ”¾é¼“åŠ±è¯­éŸ³
        function speakEncouragement() {
            if (!soundEnabled) return;
            
            const phrase = encouragementPhrases[Math.floor(Math.random() * encouragementPhrases.length)];
            const utterance = new SpeechSynthesisUtterance(phrase);
            utterance.lang = 'en-US';
            utterance.rate = 1.1;
            utterance.pitch = 1.2;
            utterance.volume = 0.8;
            
            // å»¶è¿Ÿæ’­æ”¾ï¼Œè®©éŸ³æ•ˆå…ˆå‡ºæ¥
            setTimeout(() => {
                speechSynthesis.speak(utterance);
            }, 200);
        }

        // æ˜¾ç¤ºç­”æ¡ˆ
        function showAnswer() {
            document.getElementById('answerArea').style.display = 'block';
            document.getElementById('showAnswerBtn').style.display = 'none';
        }

        // æ ‡è®°ä¸º"ä¼šäº†"
        function markCorrect() {
            // å¦‚æœæ˜¯é”™é¢˜ç»ƒä¹ æ¨¡å¼ï¼Œä»é”™é¢˜åˆ—è¡¨å’ŒlocalStorageä¸­ç§»é™¤è¯¥é¢˜
            if (mode === 'mistakes') {
                const currentWord = currentWords[currentIndex];
                
                // ä» mistakes æ•°ç»„ä¸­ç§»é™¤
                mistakes = mistakes.filter(w => 
                    !(w.word === currentWord.word && w.unit === currentWord.unit)
                );
                
                // åŒæ—¶ä»å½“å‰ç»ƒä¹ æ•°æ®ä¸­ç§»é™¤
                currentWords.splice(currentIndex, 1);
                
                // ä¿å­˜æ›´æ–°åçš„é”™é¢˜åˆ—è¡¨
                saveMistakes();
                
                console.log(`å·²ä»é”™é¢˜æœ¬ç§»é™¤: ${currentWord.word}ï¼Œå‰©ä½™é”™é¢˜: ${mistakes.length}ä¸ª`);
                
                // æ›´æ–°é”™é¢˜è®¡æ•°æ˜¾ç¤º
                updateHistoryWrongCount();
            } else {
                // æ­£å¸¸æ¨¡å¼ï¼šç§»åŠ¨åˆ°ä¸‹ä¸€é¢˜
                currentIndex++;
            }
            
            correctCount++;
            updateStats(); // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            playSound('correct1');
            speakEncouragement();
            
            // ç»§ç»­æ˜¾ç¤ºï¼ˆå¦‚æœä»currentWordsåˆ é™¤äº†ï¼ŒcurrentIndexä¸éœ€è¦å¢åŠ ï¼‰
            displayCurrentWord();
        }

        // æ ‡è®°ä¸º"è¿˜ä¸ä¼š"
        function markWrong() {
            wrongCount++;
            const word = currentWords[currentIndex];
            
            // åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œè®°å½•åˆ°é”™é¢˜åˆ—è¡¨
            // åœ¨é”™é¢˜ç»ƒä¹ æ¨¡å¼ä¸‹ï¼Œä¸éœ€è¦é‡å¤è®°å½•ï¼ˆå› ä¸ºå·²ç»åœ¨é”™é¢˜æœ¬ä¸­ï¼‰
            if (mode !== 'mistakes') {
                mistakes.push(word);
                saveMistakes();
            }
            
            updateStats(); // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            playSound('wrong');
            nextWord();
        }

        // ä¸‹ä¸€é¢˜
        function nextWord() {
            currentIndex++;
            displayCurrentWord();
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            // é”™é¢˜ç»ƒä¹ æ¨¡å¼æ˜¾ç¤ºå‰©ä½™é¢˜æ•°ï¼Œæ™®é€šæ¨¡å¼æ˜¾ç¤ºå½“å‰è¿›åº¦
            if (mode === 'mistakes') {
                // é”™é¢˜æ¨¡å¼ï¼šç›´æ¥æ˜¾ç¤ºå‰©ä½™é¢˜æ•°ï¼ˆå› ä¸ºä¼šäº†çš„é¢˜å·²ç»ä»æ•°ç»„ä¸­åˆ é™¤ï¼‰
                document.getElementById('currentIndex').textContent = 
                    currentWords.length > 0 ? `å‰©ä½™ ${currentWords.length} é¢˜` : '0 é¢˜';
                
                // ç¡®ä¿"æœ¬æ¬¡æ–°å¢"éšè—
                const currentWrongItem = document.getElementById('currentWrongItem');
                if (currentWrongItem) {
                    currentWrongItem.style.display = 'none';
                }
            } else {
                document.getElementById('currentIndex').textContent = 
                    currentWords.length > 0 ? `${currentIndex}/${currentWords.length}` : '0/0';
            }
            
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
            
            const total = correctCount + wrongCount;
            const accuracy = total > 0 ? Math.round((correctCount / total) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            // æ›´æ–°æœ¬æ¬¡é”™é¢˜è®¡æ•°ï¼ˆä»…åœ¨éé”™é¢˜æ¨¡å¼ä¸‹ï¼‰
            if (mode !== 'mistakes') {
                document.getElementById('currentWrongItemsCount').textContent = mistakes.length;
            }
            
            // æ›´æ–°å†å²é”™é¢˜è®¡æ•°
            updateHistoryWrongCount();
        }
        
        // æ›´æ–°å†å²é”™é¢˜æ€»æ•°
        function updateHistoryWrongCount() {
            const bookNumber = getBookNumber();
            const key = `wrongItems_book${bookNumber}`;
            
            let historyCount = 0;
            try {
                const saved = localStorage.getItem(key);
                if (saved) {
                    const items = JSON.parse(saved);
                    historyCount = items.length;
                }
            } catch (e) {
                console.error('è¯»å–å†å²é”™é¢˜å¤±è´¥:', e);
            }
            
            document.getElementById('historyWrongCount').textContent = historyCount;
        }

        // æ›´æ–°é”™é¢˜åˆ—è¡¨
        function updateMistakeList() {
            if (mistakes.length === 0) {
                document.getElementById('mistakeList').style.display = 'none';
                return;
            }

            document.getElementById('mistakeList').style.display = 'block';
            const container = document.getElementById('mistakeItems');
            container.innerHTML = '';

            mistakes.forEach(mistake => {
                const item = document.createElement('div');
                item.className = 'mistake-item';
                item.innerHTML = `
                    <div class="word">${mistake.word}</div>
                    <div class="meaning">${mistake.meaning}</div>
                    ${mistake.wrongAnswer ? `<div class="wrong-answer">ä½ çš„ç­”æ¡ˆï¼š${mistake.wrongAnswer}</div>` : ''}
                `;
                container.appendChild(item);
            });
        }

        // æ˜¾ç¤ºå®Œæˆç•Œé¢
        // æ˜¾ç¤ºå®Œæˆç•Œé¢
        function showCompletionScreen() {
            document.getElementById('dictationCard').style.display = 'none';
            
            const completionScreen = document.getElementById('completionScreen');
            completionScreen.classList.add('show');

            const total = correctCount + wrongCount;
            const accuracy = total > 0 ? Math.round((correctCount / total) * 100) : 100;

            document.getElementById('totalWords').textContent = total;
            document.getElementById('finalCorrect').textContent = correctCount;
            document.getElementById('finalWrong').textContent = wrongCount;
            
            const accuracyElement = document.getElementById('finalAccuracy');
            accuracyElement.textContent = accuracy + '%';
            
            // æ ¹æ®å‡†ç¡®ç‡è®¾ç½®é¢œè‰²å’Œé¼“åŠ±è¯­
            let encouragement = '';
            if (accuracy >= 90) {
                accuracyElement.className = 'accuracy';
                encouragement = 'ğŸŒŸ å¤ªæ£’äº†ï¼ä½ çš„æ‹¼å†™èƒ½åŠ›éå¸¸å‡ºè‰²ï¼';
                playSound('perfect'); // æ»¡åˆ†éŸ³æ•ˆ
            } else if (accuracy >= 70) {
                accuracyElement.className = 'accuracy medium';
                encouragement = 'ğŸ‘ åšå¾—ä¸é”™ï¼ç»§ç»­åŠªåŠ›ï¼Œä½ ä¼šæ›´å¥½çš„ï¼';
                playSound('complete'); // å®ŒæˆéŸ³æ•ˆ
            } else {
                accuracyElement.className = 'accuracy low';
                encouragement = 'ğŸ’ª åŠ æ²¹ï¼å¤šç»ƒä¹ å°±èƒ½æŒæ¡è¿™äº›å•è¯ï¼';
                playSound('complete'); // å®ŒæˆéŸ³æ•ˆ
            }
            document.getElementById('encouragement').textContent = encouragement;

            // ä¿å­˜é”™é¢˜åˆ°localStorage
            if (mistakes.length > 0) {
                saveMistakes();
            }

            // æ˜¾ç¤ºå¤ä¹ é”™é¢˜æŒ‰é’®
            if (mistakes.length > 0) {
                document.getElementById('reviewMistakesBtn').style.display = 'inline-block';
            }
        }

        // é‡ç½®
        function resetDictation() {
            currentWords = [];
            currentIndex = 0;
            correctCount = 0;
            wrongCount = 0;
            phoneticVisible = false;
            exampleVisible = false;
            
            document.getElementById('dictationCard').style.display = 'none';
            document.getElementById('completionScreen').classList.remove('show');
            document.getElementById('progressBar').style.width = '0%';
            
            updateStats();
        }

        // å·¥å…·å‡½æ•°ï¼šæå–ä¾‹å¥ä¸­çš„ä¸­æ–‡éƒ¨åˆ†
        function extractChineseExample(example) {
            // ä¾‹å¥æ ¼å¼ï¼š"I am a student. æˆ‘æ˜¯ä¸€åå­¦ç”Ÿã€‚"
            // æå–ä¸­æ–‡éƒ¨åˆ†ï¼Œé¿å…æ˜¾ç¤ºè‹±æ–‡ç­”æ¡ˆ
            const parts = example.split('ã€‚');
            if (parts.length >= 2) {
                // è·å–æœ€åä¸€ä¸ªä¸­æ–‡å¥å­ï¼ˆé€šå¸¸æ˜¯ä¸­æ–‡ç¿»è¯‘ï¼‰
                const chinesePart = parts[parts.length - 2].trim();
                // å¦‚æœåŒ…å«ä¸­æ–‡å­—ç¬¦ï¼Œè¯´æ˜è¿™æ˜¯ä¸­æ–‡éƒ¨åˆ†
                if (/[\u4e00-\u9fa5]/.test(chinesePart)) {
                    return chinesePart + 'ã€‚';
                }
            }
            
            // å¤‡ç”¨æ–¹æ¡ˆï¼šæŸ¥æ‰¾ä¸­æ–‡å­—ç¬¦å¼€å§‹çš„ä½ç½®
            const chineseMatch = example.match(/[\u4e00-\u9fa5].+/);
            if (chineseMatch) {
                return chineseMatch[0];
            }
            
            // å¦‚æœéƒ½æ²¡æ‰¾åˆ°ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ï¼ˆä¸æ˜¾ç¤ºä¾‹å¥ï¼‰
            return 'ï¼ˆæš‚æ— ä¸­æ–‡ä¾‹å¥ï¼‰';
        }

        // å·¥å…·å‡½æ•°ï¼šæ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // ä¿å­˜é”™é¢˜åˆ° localStorageï¼ˆåˆå¹¶å»é‡ï¼‰
        function saveMistakes() {
            const bookNumber = getBookNumber();
            const key = `wrongItems_book${bookNumber}`;
            try {
                // å¦‚æœæ˜¯é”™é¢˜ç»ƒä¹ æ¨¡å¼ï¼Œç›´æ¥ä¿å­˜ mistakes æ•°ç»„ï¼ˆå·²ç»æ˜¯å®Œæ•´çš„é”™é¢˜åˆ—è¡¨ï¼‰
                if (mode === 'mistakes') {
                    localStorage.setItem(key, JSON.stringify(mistakes));
                    console.log(`å·²ä¿å­˜é”™é¢˜: ${mistakes.length}ä¸ª`);
                } else {
                    // æ­£å¸¸æ¨¡å¼ï¼šåˆå¹¶æ–°é”™é¢˜åˆ°ç°æœ‰é”™é¢˜
                    let existingWrong = [];
                    const saved = localStorage.getItem(key);
                    if (saved) {
                        existingWrong = JSON.parse(saved);
                    }
                    
                    // åˆå¹¶æ–°é”™é¢˜ï¼ˆå»é‡ï¼‰
                    mistakes.forEach(item => {
                        // æ ¹æ®å•è¯å’Œå•å…ƒå»é‡
                        if (!existingWrong.find(w => w.word === item.word && w.unit === item.unit)) {
                            existingWrong.push(item);
                        }
                    });
                    
                    // é™åˆ¶é”™é¢˜æ•°é‡ï¼ˆæœ€å¤š200ä¸ªï¼‰
                    if (existingWrong.length > 200) {
                        existingWrong = existingWrong.slice(-200);
                    }
                    
                    localStorage.setItem(key, JSON.stringify(existingWrong));
                    console.log(`å·²ä¿å­˜é”™é¢˜: ${mistakes.length}ä¸ªï¼Œé”™é¢˜æœ¬æ€»æ•°: ${existingWrong.length}`);
                }
            } catch (e) {
                console.error('ä¿å­˜é”™é¢˜å¤±è´¥:', e);
            }
        }

        // åŠ è½½é”™é¢˜
        function loadMistakes() {
            const bookNumber = getBookNumber();
            const key = `wrongItems_book${bookNumber}`;
            try {
                const saved = localStorage.getItem(key);
                if (saved) {
                    return JSON.parse(saved);
                }
            } catch (e) {
                console.error('åŠ è½½é”™é¢˜å¤±è´¥:', e);
            }
            return [];
        }

        // å®‰å…¨è¿”å›åŠŸèƒ½ï¼šæå‰é€€å‡ºæ—¶ä¿å­˜å½“å‰é”™é¢˜
        function safeReturn() {
            // å¦‚æœæ­£åœ¨ç»ƒä¹ ä¸­ï¼Œç›´æ¥ä¿å­˜å¹¶è¿”å›
            if (currentIndex > 0) {
                // ä¿å­˜å½“å‰é”™é¢˜ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
                if (mistakes.length > 0) {
                    saveMistakes();
                    console.log(`æå‰è¿”å› - å·²ä¿å­˜ ${mistakes.length} ä¸ªé”™é¢˜`);
                }
                
                // ç›´æ¥è¿”å›ï¼Œä¸éœ€è¦ç¡®è®¤
                window.location.href = 'index.html';
            } else {
                // è¿˜æ²¡å¼€å§‹åšé¢˜ï¼Œç›´æ¥è¿”å›
                window.location.href = 'index.html';
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            loadSoundPreference(); // åŠ è½½éŸ³æ•ˆåå¥½
            init();
        };
    </script>
</body>
</html>
